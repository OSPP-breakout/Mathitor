/**
 * MathQuill v0.10.1, by Han, Jeanine, and Mary
 * http://mathquill.com | maintainers@mathquill.com
 *
 * This Source Code Form is subject to the terms of the
 * Mozilla Public License, v. 2.0. If a copy of the MPL
 * was not distributed with this file, You can obtain
 * one at http://mozilla.org/MPL/2.0/.
 */
var __extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}();!function(){var I,g,M,R,z,y,u,o,N,F,P,$,G,H,U,h,W,V,K,Z,Y,c,X,J,s,f,tt,et,nt,n,i,rt,a,l,it,ot,st,at,lt,pt,ct,ut,ht,ft,dt,t,mt,gt,yt,wt,bt,vt,xt,qt,kt,_t,e,St,Ot,Lt,Tt,Ct,At,jt,Dt,Qt,w,Et,Bt,It,Mt,Rt,zt,Nt,Ft,Pt,$t,Gt,Ht,Ut,Wt,Vt,Kt,Zt,Yt,Xt,Jt,te,ee,ne,re,ie,oe,se,ae,le,pe,ce,ue,he,fe,de,me,ge,ye,we,be,ve,xe,qe,ke,_e,Se,Oe,Le,Te,Ce,Ae,je,De,Qe,Ee,Be,Ie,Me,Re,ze,Ne,Fe,Pe,$e,Ge,He,Ue,We,Ve,Ke,Ze,Ye,Xe,Je,tn,en,nn,rn,on,sn,an,ln,pn,cn,un,hn,fn,dn,mn,b=-1,gn=window.jQuery,yn=Math.min,wn=Math.max;if(!gn)throw"MathQuill requires jQuery 1.5.2+ to be loaded first";function bn(){}function p(t,e){if(!e)throw new Error("prayer failed: "+t)}function d(t){p("a direction was passed",t===b||1===t)}function vn(t){this.jQ=gn('<span class="mq-aria-alert" aria-live="assertive" aria-atomic="true"></span>'),this.msg="",this.items=[],this.controller=t}function xn(t,e,n){this.init(t,e,n)}function qn(t,e){var n,r=t[b];if(r&&(n=t[1]))for(n=n[1];r!==n&&!1!==e(r);r=r[1]);}function kn(t,e,n){var r,i=t[b];if(i&&(r=t[1]))for(r=r[1];i!==r;i=i[1])e=n(e,i);return e}function m(){var t;this[Pt]=0,this[$t]=0,this.parent=0,this.ends=((t={})[b]=0,t[1]=0,t),this.jQ=R,this.id=m.uniqueNodeId(),m.TempByIdDict[this.id]=this,m.scheduleDictionaryCleaning()}function _n(t,e,n){p("a parent is always present",t),p("leftward is properly set up",e?e[1]===n&&e.parent===t:t.ends[b]===n),p("rightward is properly set up",n?n[b]===e&&n.parent===t:t.ends[1]===e)}function Sn(t,e,n){this.jQ=R,this.disowned=!1,d(n=void 0===n?b:n),p("no half-empty fragments",!t==!e),this.ends={},t&&e&&(p("withDir is passed to Fragment",t instanceof s),p("oppDir is passed to Fragment",e instanceof s),p("withDir and oppDir have the same parent",t.parent===e.parent),this.ends[n]=t,this.ends[-n]=e,t=this.fold([],function(t,e){return t.push.apply(t,e.jQ.get()),t}),this.jQ=this.jQ.add(t))}function On(t){return t&&t.prototype instanceof s}function Ln(t,e,n){t=Gt.call(this,t,e,n)||this;return t.ancestors={},t}function r(t,e,n){var r,t=Ht.call(this,t)||this;return t.upDownCache={},t.controller=n,t.options=e,r=t.jQ=t._jQ=g('<span class="mq-cursor">&#8203;</span>'),t.blink=function(){r.toggleClass("mq-blink")},t}function Tn(t,e,n){t=Ut.call(this,t,e,n)||this;return t.jQ=t.jQ.wrapAll('<span class="mq-selection"></span>').parent(),t}function v(t,e,n){this.id=t.id,this.data={},this.root=t,this.container=e,this.options=n,this.aria=new I(this.getControllerSelf()),this.ariaLabel="Math Input",this.ariaPostLabel="",t.controller=this.getControllerSelf(),this.cursor=t.cursor=new F(t,n,this.getControllerSelf())}function Cn(t){return V(),Nt(t)}function An(o){var s,t,e,a,n,r,i;if(!(K<=o&&o<=Z))throw"Only interface versions between "+K+" and "+Z+" supported. You specified: "+o;function l(t,e){var n,r,i;for(n in e&&e.handlers&&(e.handlers={fns:e.handlers,APIClasses:a}),e)e.hasOwnProperty(n)&&(r=e[n],i=U[n],t[n]=i?i(r):r)}function p(t){var e=r.call(this)||this;return e.__controller=t,e.__options=t.options,e.id=t.id,e.data=t.data,e}function c(){return null!==i&&i.apply(this,arguments)||this}for(n in(s=function(t){return t&&t.nodeType&&(t=(t=z.getNodeOfElement(g(t).children(".mq-root-block")[0]))&&t.controller)?new a[t.KIND_OF_MQ](t):null}).L=b,s.R=1,s.saneKeyboardEvents=X,s.config=function(t){return l(h.prototype,t),this},s.registerEmbed=function(t,e){if(!/^[a-z][a-z0-9]*$/i.test(t))throw"Embed name must start with letter and be only letters and digits";H[t]=e},__extends(p,r=W),p.prototype.__mathquillify=function(t){var e,n=this.__controller,r=n.root,i=n.container;n.createTextarea(),e=i.addClass(t).contents().detach(),r.jQ=g('<span class="mq-root-block"/>').appendTo(i),z.linkElementByBlockId(r.jQ[0],r.id),this.latex(e.text()),this.revert=function(){return i.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(e)}},p.prototype.config=function(t){return l(this.__options,t),this},p.prototype.el=function(){return this.__controller.container[0]},p.prototype.text=function(){return this.__controller.exportText()},p.prototype.mathspeak=function(){return this.__controller.exportMathSpeak()},p.prototype.latex=function(t){var e;return 0<arguments.length?(this.__controller.renderLatexMath(t),e=this.__controller.cursor,this.__controller.blurred&&e.hide().parent.blur(e),this):this.__controller.exportLatex()},p.prototype.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},p.prototype.reflow=function(){return this.__controller.root.postOrder(function(t){t.reflow()}),this},s.prototype=(t=p).prototype,__extends(c,i=t),c.prototype.__mathquillify=function(t){return i.prototype.__mathquillify.call(this,t),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this},c.prototype.focus=function(){return this.__controller.getTextareaOrThrow()[0].focus(),this.__controller.scrollHoriz(),this},c.prototype.blur=function(){return this.__controller.getTextareaOrThrow().blur(),this},c.prototype.write=function(t){this.__controller.writeLatex(t),this.__controller.scrollHoriz();t=this.__controller.cursor;return this.__controller.blurred&&t.hide().parent.blur(t),this},c.prototype.empty=function(){var t=this.__controller.root,e=this.__controller.cursor;return t.ends[b]=t.ends[1]=0,t.jQ.empty(),delete e.selection,e.insAtRightEnd(t),this},c.prototype.cmd=function(t){var e,n=this.__controller.notify(void 0),r=n.cursor;return/^\\[a-z]+$/i.test(t)&&!r.isTooDeep()?(t=t.slice(1),(e=u[t])&&(e=e.constructor?new e(t):e(t),r.selection&&e.replaces(r.replaceSelection()),e.createLeftOf(r.show()))):r.parent.write(r,t),n.scrollHoriz(),n.blurred&&r.hide().parent.blur(r),this},c.prototype.select=function(){return this.__controller.selectAll(),this},c.prototype.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},c.prototype.moveToDirEnd=function(t){return this.__controller.notify("move").cursor.insAtDirEnd(t,this.__controller.root),this},c.prototype.moveToLeftEnd=function(){return this.moveToDirEnd(b)},c.prototype.moveToRightEnd=function(){return this.moveToDirEnd(1)},c.prototype.keystroke=function(t,e){for(var n=t.replace(/^\s+|\s+$/g,"").split(/\s+/),r=0;r<n.length;r+=1)this.__controller.keystroke(n[r],e||{preventDefault:bn});return this},c.prototype.typedText=function(t){for(var e=0;e<t.length;e+=1)this.__controller.typedText(t.charAt(e));return this},c.prototype.dropEmbedded=function(t,e,n){var r=t-g(window).scrollLeft(),i=e-g(window).scrollTop(),r=document.elementFromPoint(r,i);this.__controller.seek(g(r),t,e),(new zt).setOptions(n).createLeftOf(this.__controller.cursor)},c.prototype.setAriaLabel=function(t){return this.__controller.setAriaLabel(t),this},c.prototype.getAriaLabel=function(){return this.__controller.getAriaLabel()},c.prototype.setAriaPostLabel=function(t,e){return this.__controller.setAriaPostLabel(t,e),this},c.prototype.getAriaPostLabel=function(){return this.__controller.getAriaPostLabel()},c.prototype.clickAt=function(t,e,n){n=n||document.elementFromPoint(t,e);var r=this.__controller,i=r.root;return gn.contains(i.jQ[0],n)||(n=i.jQ[0]),r.seek(g(n),t+pageXOffset,e+pageYOffset),r.blurred&&this.focus(),this},c.prototype.ignoreNextMousedown=function(t){return this.__controller.cursor.options.ignoreNextMousedown=t,this},e=c,(s.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"}).prototype=e.prototype,a={AbstractMathQuill:t,EditableField:e},G)!function(r,t){var i=a[r]=t(a);(s[r]=function(t,e){var n=s(t);return n instanceof i||!t||!t.nodeType?n:((n=new nt(new i.RootBlock,g(t),new h)).KIND_OF_MQ=r,new i(n).__mathquillify(e,o))}).prototype=i.prototype}(n,G[n]);return s}function jn(t){t.moveOutOf=function(t){this.controller.handle("moveOutOf",t)},t.deleteOutOf=function(t){this.controller.handle("deleteOutOf",t)},t.selectOutOf=function(t){this.controller.handle("selectOutOf",t)},t.upOutOf=function(t){this.controller.handle("upOutOf",t)},t.downOutOf=function(t){this.controller.handle("downOutOf",t)},t.reflow=function(){this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}function Dn(t,e){throw"Parse Error: "+e+" at "+(t=t?"'"+t+"'":"EOF")}function x(t){this._=t}function Qn(t){var e=t.which||t.keyCode,n=Wt[e],r=[];return t.ctrlKey&&r.push("Ctrl"),t.originalEvent&&t.originalEvent.metaKey&&r.push("Meta"),t.altKey&&r.push("Alt"),t.shiftKey&&r.push("Shift"),t=n||String.fromCharCode(e),r.length||n?(r.push(t),r.join("-")):t}function En(){return null!==Vt&&Vt.apply(this,arguments)||this}function Bn(){return null!==Kt&&Kt.apply(this,arguments)||this}function q(){return null!==Zt&&Zt.apply(this,arguments)||this}function k(){return null!==Yt&&Yt.apply(this,arguments)||this}function In(t){return Xt.call(this)||this}function Mn(t){for(var e=t[0]||new l,n=1;n<t.length;n+=1)t[n].children().adopt(e,e.ends[1],0);return e}function Rn(){return null!==pe&&pe.apply(this,arguments)||this}function zn(){return null!==ce&&ce.apply(this,arguments)||this}function Nn(){return null!==ue&&ue.apply(this,arguments)||this}function _(){return null!==he&&he.apply(this,arguments)||this}function Fn(){return null!==fe&&fe.apply(this,arguments)||this}function S(t,e,n){var r=de.call(this)||this;return r.textTemplate=[""],r.mathspeakTemplate=[""],r.setCtrlSeqHtmlAndText(t,e,n),r}function O(t,e,n,r){var i=me.call(this)||this;return i.setCtrlSeqHtmlTextAndMathspeak(t,e,n,r),i}function Pn(t,e,n){return ge.call(this,t,"<span>"+(e||t)+"</span>",void 0,n)||this}function L(t,e,n){return function(){return new rt(t,e,n)}}function $n(t,e,n,r,i){return i?ye.call(this,t,"<span>"+(e||t)+"</span>",void 0,r)||this:ye.call(this,t,'<span class="mq-binary-operator">'+e+"</span>",n,r)||this}function T(t,e,n,r){return function(){return new a(t,e,n,r)}}function C(){var t=null!==we&&we.apply(this,arguments)||this;return t.ariaLabel="block",t}function Gn(){return null!==be&&be.apply(this,arguments)||this}function A(){var t=null!==ve&&ve.apply(this,arguments)||this;return t.ctrlSeq="\\text",t.ariaLabel="Text",t.mathspeakTemplate=["StartText","EndText"],t}function Hn(t){var e,n;if(t.jQ[0].normalize(),e=t.jQ[0].firstChild)return p("only node in TextBlock span is Text node",3===e.nodeType),(n=new st(e.data)).jQadd(e),t.children().disown(),n.adopt(t,0,0),n}function j(t){var e=xe.call(this)||this;return e.textStr=t,e}function Un(e,n,r,i){return __extends(t,o=ot),t.prototype.html=function(){var t="mathquill-command-id="+this.id;return"<"+r+" "+i+" "+t+">"+this.textContents()+"</"+r+">"},t;function t(){var t=null!==o&&o.apply(this,arguments)||this;return t.ctrlSeq=e,t.mathspeakTemplate=["Start"+n,"End"+n],t.ariaLabel=n,t}var o}function Wn(t){var e=qe.call(this,"$")||this;return e.htmlTemplate='<span class="mq-math-mode">&0</span>',e.cursor=t,e}function Vn(){return null!==ke&&ke.apply(this,arguments)||this}function Kn(){return null!==_e&&_e.apply(this,arguments)||this}function D(){return null!==Se&&Se.apply(this,arguments)||this}function Zn(t,e,n){return Oe.call(this,t,'<span class="mq-digit">'+(e||t)+"</span>",void 0,n)||this}function Yn(t,e){return Le.call(this,t,"<var>"+(e||t)+"</var>")||this}function Xn(t,e){return function(){return new ut(t,e)}}function Q(t){var e=Te.call(this,t)||this;return e.letter=t,e}vn.prototype.setContainer=function(t){this.jQ.appendTo(t)},vn.prototype.queue=function(t,e){var n,r;return void 0===e&&(e=!1),n="",t instanceof s?(r=t.mathspeak({ignoreShorthand:!0}),e&&(t.parent&&t.parent.ariaLabel&&"block"===t.ariaLabel?n=t.parent.ariaLabel+" "+r:t.ariaLabel&&(n=t.ariaLabel+" "+r)),""===n&&(n=r)):n=t||"",this.items.push(n),this},vn.prototype.queueDirOf=function(t){return d(t),this.queue(t===b?"before":"after")},vn.prototype.queueDirEndOf=function(t){return d(t),this.queue(t===b?"beginning of":"end of")},vn.prototype.alert=function(t){return t&&this.queue(t),this.items.length&&(this.msg=this.items.join(" ").replace(/ +(?= )/g,"").trim(),this.controller.containerHasFocus())&&this.jQ.empty().text(this.msg),this.clear()},vn.prototype.clear=function(){return this.items.length=0,this},I=vn,(g=gn).fn.insDirOf=function(t,e){return t===b?this.insertBefore(e.first()):this.insertAfter(e.last())},g.fn.insAtDirEnd=function(t,e){return t===b?this.prependTo(e):this.appendTo(e)},xn.prototype.init=function(t,e,n){this.parent=t,this[b]=e,this[1]=n},xn.copy=function(t){return new xn(t.parent,t[b],t[1])},M=xn,R=g(),m.uniqueNodeId=function(){return m.idCounter+=1},m.getNodeOfElement=function(t){if(t){if(t.nodeType)return t.mqBlockNode||t.mqCmdNode;throw new Error("must pass an HTMLElement to NodeBase.getNodeOfElement")}},m.linkElementByBlockId=function(t,e){m.linkElementByBlockNode(t,m.TempByIdDict[e])},m.linkElementByBlockNode=function(t,e){t.mqBlockNode=e},m.linkElementByCmdNode=function(t,e){t.mqCmdNode=e},m.scheduleDictionaryCleaning=function(){m.cleaningScheduled||(m.cleaningScheduled=!0,setTimeout(m.cleanDictionary))},m.cleanDictionary=function(){m.cleaningScheduled=!1,m.TempByIdDict={}},m.prototype.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},m.prototype.jQadd=function(t){return this.jQ=this.jQ.add(t)},m.prototype.jQize=function(t){var e,n;for(e=g(t||this.html()),n=0;n<e.length;n+=1)!function t(e){var n,r;"getAttribute"in e&&((n=e.getAttribute("mathquill-command-id"))&&(e.removeAttribute("mathquill-command-id"),(n=m.TempByIdDict[n]).jQadd(e),m.linkElementByCmdNode(e,n)),n=e.getAttribute("mathquill-block-id"))&&(e.removeAttribute("mathquill-block-id"),(n=m.TempByIdDict[n]).jQadd(e),m.linkElementByBlockNode(e,n));for(r=e.firstChild;r;r=r.nextSibling)t(r)}(e[n]);return e},m.prototype.createDir=function(t,e){d(t);return this.jQize(),this.jQ.insDirOf(t,e.jQ),e[t]=this.adopt(e.parent,e[b],e[1]),this},m.prototype.createLeftOf=function(t){this.createDir(b,t)},m.prototype.selectChildren=function(t,e){return new P(t,e)},m.prototype.bubble=function(t){for(var e=this.getSelfNode();e&&!1!==t(e);e=e.parent);return this},m.prototype.postOrder=function(n){var t=this.getSelfNode();return function t(e){return!!e&&(e.eachChild(t),n(e),!0)}(t),t},m.prototype.isEmpty=function(){return 0===this.ends[b]&&0===this.ends[1]},m.prototype.isQuietEmptyDelimiter=function(t){var e;return!!this.isEmpty()&&!!t&&!(!this.parent||void 0===this.parent.ctrlSeq)&&(e=this.parent.ctrlSeq.replace(/^\\(left|right)?/,""),t.hasOwnProperty(e))},m.prototype.isStyleBlock=function(){return!1},m.prototype.isTextBlock=function(){return!1},m.prototype.children=function(){return new y(this.ends[b],this.ends[1])},m.prototype.eachChild=function(t){return qn(this.ends,t),this},m.prototype.foldChildren=function(t,e){return kn(this.ends,t,e)},m.prototype.withDirAdopt=function(t,e,n,r){var i=this.getSelfNode();return new y(i,i).withDirAdopt(t,e,n,r),this},m.prototype.adopt=function(t,e,n){var r=this.getSelfNode();return new y(r,r).adopt(t,e,n),this.getSelfNode()},m.prototype.disown=function(){var t=this.getSelfNode();return new y(t,t).disown(),this},m.prototype.remove=function(){return this.jQ.remove(),this.disown()},m.prototype.shouldIgnoreSubstitutionInSimpleSubscript=function(t){return!!t.disableAutoSubstitutionInSubscripts&&!!this.parent&&this.parent.parent instanceof Ot&&!!this.parent.jQ.hasClass("mq-sub")},m.prototype.getSelfNode=function(){return this},m.prototype.parser=function(){},m.prototype.html=function(){return""},m.prototype.text=function(){return""},m.prototype.latex=function(){return""},m.prototype.finalizeTree=function(t,e){},m.prototype.contactWeld=function(t,e){},m.prototype.blur=function(t){},m.prototype.focus=function(){},m.prototype.intentionalBlur=function(){},m.prototype.reflow=function(){},m.prototype.registerInnerField=function(t,e){},m.prototype.chToCmd=function(t,e){},m.prototype.mathspeak=function(t){return""},m.prototype.seek=function(t,e){},m.prototype.siblingDeleted=function(t,e){},m.prototype.siblingCreated=function(t,e){},m.prototype.finalizeInsert=function(t,e){},m.prototype.fixDigitGrouping=function(t){},m.prototype.writeLatex=function(t,e){},m.prototype.write=function(t,e){},Pt=b,$t=1,m.idCounter=0,m.TempByIdDict={},m.cleaningScheduled=!1,z=m,Sn.prototype.withDirAdopt=function(t,e,n,r){return t===b?this.adopt(e,n,r):this.adopt(e,r,n)},Sn.prototype.adopt=function(e,n,t){var r,i;return _n(e,n,t),this.disowned=!1,(r=this.ends[b])&&(i=this.ends[1])&&(n||(e.ends[b]=r),t?t[b]=i:e.ends[1]=i,i[1]=t,this.each(function(t){return t[b]=n,t.parent=e,n&&(n[1]=t),n=t,!0})),this},Sn.prototype.disown=function(){var t,e,n=this,r=n.ends[b];return r&&!n.disowned&&(this.disowned=!0,t=n.ends[1])&&(_n(e=r.parent,r[b],r),_n(e,t,t[1]),r[b]?r[b][1]=t[1]:e.ends[b]=t[1],t[1]?t[1][b]=r[b]:e.ends[1]=r[b]),n},Sn.prototype.remove=function(){return this.jQ.remove(),this.disown()},Sn.prototype.each=function(t){return qn(this.ends,t),this},Sn.prototype.fold=function(t,e){return kn(this.ends,t,e)},y=Sn,u={},o={},__extends(Ln,Gt=M),Ln.fromCursor=function(t){return new Ln(t.parent,t[b],t[1])},N=Ln,__extends(r,Ht=M),r.prototype.show=function(){var t;return this.jQ=this._jQ.removeClass("mq-blink"),this.intervalId?clearInterval(this.intervalId):(this[1]?(t=this.selection)&&t.ends[b][b]===this[b]?this.jQ.insertBefore(t.jQ):this.jQ.insertBefore(this[1].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},r.prototype.hide=function(){return this.intervalId&&clearInterval(this.intervalId),this.intervalId=0,this.jQ.detach(),this.jQ=g(),this},r.prototype.withDirInsertAt=function(t,e,n,r){var i=this.parent;this.parent=e,this[t]=n,this[-t]=r,i!==e&&i.blur&&i.blur(this)},r.prototype.insDirOf=function(t,e){return d(t),this.jQ.insDirOf(t,e.jQ),this.withDirInsertAt(t,e.parent,e[t],e),this.parent.jQ.addClass("mq-hasCursor"),this},r.prototype.insLeftOf=function(t){return this.insDirOf(b,t)},r.prototype.insRightOf=function(t){return this.insDirOf(1,t)},r.prototype.insAtDirEnd=function(t,e){return d(t),this.jQ.insAtDirEnd(t,e.jQ),this.withDirInsertAt(t,e,0,e.ends[t]),e.focus(),this},r.prototype.insAtLeftEnd=function(t){return this.insAtDirEnd(b,t)},r.prototype.insAtRightEnd=function(t){return this.insAtDirEnd(1,t)},r.prototype.jumpUpDown=function(t,e){var n,r=this;r.upDownCache[t.id]=M.copy(r),(t=r.upDownCache[e.id])?(n=t[1])?r.insLeftOf(n):r.insAtRightEnd(t.parent):(n=r.offset().left,e.seek(n,r)),r.controller.aria.queue(e,!0)},r.prototype.offset=function(){var t=this.jQ.removeClass("mq-cursor").offset();return this.jQ.addClass("mq-cursor"),t},r.prototype.unwrapGramp=function(){var t,e,n,r=this.parent.parent,i=r.parent,o=r[1],s=r[b];if(r.disown().eachChild(function(t){return t.isEmpty()||(t.children().adopt(i,s,o).each(function(t){return t.jQ.insertBefore(r.jQ.first()),!0}),s=t.ends[1]),!0}),!this[1])if(e=this[b])this[1]=e[1];else for(;!this[1];){if(!(t=this.parent[1])){this[1]=r[1],this.parent=i;break}this.parent=t,this[1]=t.ends[b]}(e=this[1])?this.insLeftOf(e):this.insAtRightEnd(i),r.jQ.remove(),e=r[b],n=r[1],e&&e.siblingDeleted(this.options,1),n&&n.siblingDeleted(this.options,b)},r.prototype.startSelection=function(){for(var t=this.anticursor=N.fromCursor(this),e=t.ancestors,n=t;n.parent;n=n.parent)e[n.parent.id]=n},r.prototype.endSelection=function(){delete this.anticursor},r.prototype.select=function(){var t,e,n,r,i,o,s,a,l=this.anticursor;if(this[b]===l[b]&&this.parent===l.parent)return!1;for(e=this;e.parent;e=e.parent)if(e.parent.id in l.ancestors){t=e.parent;break}if(p("cursor and anticursor in the same tree",t),a=t,n=l.ancestors[a.id],o=1,e[b]!==n)for(s=e;s;s=s[1])if(s[1]===n[1]){o=b,r=e,i=n;break}return 1===o&&(r=n,i=e),r instanceof M&&(r=r[1]),i instanceof M&&(i=i[b]),this.hide().selection=a.selectChildren(r,i),a=this.selection.ends[o],this.insDirOf(o,a),this.selectionChanged(),!0},r.prototype.resetToEnd=function(t){this.clearSelection();t=t.root;this[1]=0,this[b]=t.ends[1],this.parent=t},r.prototype.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},r.prototype.deleteSelection=function(){var t=this.selection;t&&(this[b]=t.ends[b][b],this[1]=t.ends[1][1],t.remove(),this.selectionChanged(),delete this.selection)},r.prototype.replaceSelection=function(){var t=this.selection;return t&&(this[b]=t.ends[b][b],this[1]=t.ends[1][1],delete this.selection),t},r.prototype.depth=function(){for(var t=this,e=0;t=t.parent;)e+=t instanceof l?1:0;return e},r.prototype.isTooDeep=function(t){return void 0!==this.options.maxDepth&&this.depth()+(t||0)>this.options.maxDepth},r.prototype.selectionChanged=function(){},F=r,__extends(Tn,Ut=y),Tn.prototype.adopt=function(t,e,n){return this.jQ.replaceWith(this.jQ=this.jQ.children()),Ut.prototype.adopt.call(this,t,e,n)},Tn.prototype.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),this},Tn.prototype.join=function(n,r){return void 0===r&&(r=""),this.fold("",function(t,e){return t+r+e[n]()})},P=Tn,v.prototype.getControllerSelf=function(){return this},v.prototype.handle=function(t,e){var n,r=this.options.handlers;r&&r.fns[t]&&(n=new r.APIClasses[this.KIND_OF_MQ](this),e===b||1===e?r.fns[t](e,n):r.fns[t](n))},v.onNotify=function(t){v.notifyees.push(t)},v.prototype.notify=function(t){for(var e=0;e<v.notifyees.length;e+=1)v.notifyees[e](this.cursor,t);return this},v.prototype.setAriaLabel=function(t){var e=this.getAriaLabel();return t&&"string"==typeof t&&""!==t?this.ariaLabel=t:this.editable?this.ariaLabel="Math Input":this.ariaLabel="",this.ariaLabel===e||this.containerHasFocus()||this.updateMathspeak(),this},v.prototype.getAriaLabel=function(){return"Math Input"!==this.ariaLabel?this.ariaLabel:this.editable?"Math Input":""},v.prototype.setAriaPostLabel=function(t,e){var n=this;return t&&"string"==typeof t&&""!==t?(t!==this.ariaPostLabel&&"number"==typeof e&&(this._ariaAlertTimeout&&clearTimeout(this._ariaAlertTimeout),this._ariaAlertTimeout=setTimeout(function(){n.containerHasFocus()?n.aria.alert(n.root.mathspeak().trim()+" "+t.trim()):n.updateMathspeak()},e)),this.ariaPostLabel=t):(this._ariaAlertTimeout&&clearTimeout(this._ariaAlertTimeout),this.ariaPostLabel=""),this},v.prototype.getAriaPostLabel=function(){return this.ariaPostLabel||""},v.prototype.containerHasFocus=function(){return document.activeElement&&this.container&&this.container[0]&&this.container[0].contains(document.activeElement)},v.prototype.getTextareaOrThrow=function(){var t=this.textarea;if(t)return t;throw new Error("expected a textarea")},v.prototype.getTextareaSpanOrThrow=function(){var t=this.textareaSpan;if(t)return t;throw new Error("expected a textareaSpan")},v.prototype.exportMathSpeak=function(){return this.root.mathspeak()},v.prototype.updateMathspeak=function(){},v.prototype.scrollHoriz=function(){},v.prototype.selectionChanged=function(){},v.prototype.setOverflowClasses=function(){},v.notifyees=[],$=v,G={},H={},U=new function(){},h=function(){},V=function(){window.console&&console.warn('You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. Easiest fix is to do the following before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')},Cn.prototype=(W=function(){}).prototype,Cn.VERSION="v0.10.1",Cn.interfaceVersion=function(t){if(1!==t)throw"Only interface version 1 supported. You specified: "+t;return(V=function(){window.console&&console.warn('You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')})(),Cn},K=(Cn.getInterface=An).MIN=1,Z=An.MAX=2,Cn.noConflict=function(){return window.MathQuill=Y,Cn},Y=window.MathQuill,window.MathQuill=Cn,x.prototype.parse=function(t){return this.skip(x.eof)._(""+t,function(t,e){return e},Dn)},x.prototype.or=function(i){p("or is passed a parser",i instanceof x);var t=this;return new x(function(e,n,r){return t._(e,n,function(t){return i._(e,n,r)})})},x.prototype.then=function(i){var e=this;return new x(function(t,n,r){return e._(t,function(t,e){e=i instanceof x?i:i(e);return p("a parser is returned",e instanceof x),e._(t,n,r)},r)})},x.prototype.many=function(){var s=this;return new x(function(n,t,e){for(var r=[];s._(n,i,o););return t(n,r);function i(t,e){return n=t,r.push(e),!0}function o(){return!1}})},x.prototype.times=function(c,u){arguments.length<2&&(u=c);var h=this;return new x(function(n,t,e){for(var r,i=[],o=!0,s=0;s<c;s+=1)if(!(o=!!h._(n,a,l)))return e(n,r);for(;s<u&&o;s+=1)h._(n,a,p);return t(n,i);function a(t,e){return i.push(e),n=t,!0}function l(t,e){return r=e,n=t,!1}function p(t,e){return!1}})},x.prototype.result=function(t){return this.then(x.succeed(t))},x.prototype.atMost=function(t){return this.times(0,t)},x.prototype.atLeast=function(t){var n=this;return n.times(t).then(function(e){return n.many().map(function(t){return e.concat(t)})})},x.prototype.map=function(e){return this.then(function(t){return x.succeed(e(t))})},x.prototype.skip=function(e){return this.then(function(t){return e.result(t)})},x.string=function(i){var o=i.length,s="expected '"+i+"'";return new x(function(t,e,n){var r=t.slice(0,o);return r===i?e(t.slice(o),r):n(t,s)})},x.regex=function(i){p("regexp parser is anchored","^"===i.toString().charAt(1));var o="expected "+i;return new x(function(t,e,n){var r=i.exec(t);return r?(r=r[0],e(t.slice(r.length),r)):n(t,o)})},x.succeed=function(n){return new x(function(t,e){return e(t,n)})},x.fail=function(r){return new x(function(t,e,n){return n(t,r)})},x.letter=x.regex(/^[a-z]/i),x.letters=x.regex(/^[a-z]*/i),x.digit=x.regex(/^[0-9]/),x.digits=x.regex(/^[0-9]*/),x.whitespace=x.regex(/^\s+/),x.optWhitespace=x.regex(/^\s*/),x.any=new x(function(t,e,n){return t?e(t.slice(1),t.charAt(0)):n(t,"expected any character")}),x.all=new x(function(t,e,n){return e("",t)}),x.eof=new x(function(t,e,n){return t?n(t,"expected EOF"):e(t,t)}),c=x,Wt={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"},X=function(t,e){var n,r,i,o,s,a;function l(t){o=t,clearTimeout(s),s=setTimeout(t)}function p(e){l(function(t){o=bn,clearTimeout(s),e(t)})}function c(){try{i[0].select()}catch(t){}}function u(){e.options&&e.options.overrideKeystroke?e.options.overrideKeystroke(Qn(n),n):e.keystroke(Qn(n),n)}function h(t){t.target===i[0]&&(n=t,r=null,a&&p(function(t){t&&"focusout"===t.type||c()}),u())}function f(t){if(t&&t.originalEvent)switch(t.originalEvent.key){case"ArrowRight":case"ArrowLeft":case"ArrowDown":case"ArrowUp":return 1}}function d(t){t.target!==i[0]||(n&&r&&u(),f(r=t))||l(g)}function m(t){t.target!==i[0]||!n||r||f(t)||l(g)}function g(){var t;"selectionStart"in(t=i[0])&&t.selectionStart!==t.selectionEnd||(1===(t=i.val()).length?(i.val(""),e.options&&e.options.overrideTypedText?e.options.overrideTypedText(t):e.typedText(t)):t&&c())}function y(){r=n=null,o=bn,clearTimeout(s),i.val("")}function w(){var t=i.val();i.val(""),t&&e.paste(t)}return r=n=null,i=gn(t),t=gn(e.container||i),o=bn,t.bind("keydown keypress input keyup paste",function(t){o(t)}),a=!1,e.options&&e.options.disableCopyPaste?t.bind({keydown:h,keypress:d,keyup:m,focusout:y,copy:function(t){t.preventDefault()},cut:function(t){t.preventDefault()},paste:function(t){t.preventDefault()}}):t.bind({keydown:h,keypress:d,keyup:m,focusout:y,cut:function(){p(function(){e.cut()})},copy:function(){p(function(){e.copy()})},paste:function(t){t.target===i[0]&&(document.activeElement!==i[0]&&i[0].focus(),l(w))}}),{select:function(t){o(),o=bn,clearTimeout(s),i.val(t),t&&c(),a=!!t}}},__extends(En,Vt=$),En.prototype.exportText=function(){return this.root.foldChildren("",function(t,e){return t+e.text()})},Rt=En,$.onNotify(function(t,e){"edit"!==e&&"replace"!==e&&void 0!==e||(e=t.controller)&&e.options.enableDigitGrouping&&!1===e.blurred&&e.disableGroupingForSeconds(1)}),__extends(Bn,Kt=Rt),Bn.prototype.disableGroupingForSeconds=function(t){clearTimeout(this.__disableGroupingTimeout);var e=this.root.jQ;0===t?e.removeClass("mq-suppress-grouping"):(e.addClass("mq-suppress-grouping"),this.__disableGroupingTimeout=setTimeout(function(){e.removeClass("mq-suppress-grouping")},1e3*t))},Bn.prototype.focusBlurEvents=function(){var t,e,n,r;function i(){clearTimeout(r),n.selection&&n.selection.jQ.addClass("mq-blur"),o(),t.updateMathspeak()}function o(){n.hide().parent.blur(n),t.container.removeClass("mq-focused"),g(window).unbind("blur",i),t.options&&t.options.resetCursorOnBlur&&n.resetToEnd(t)}e=(t=this).root,n=t.cursor,t.getTextareaOrThrow().focus(function(){t.updateMathspeak(),t.blurred=!1,clearTimeout(r),t.container.addClass("mq-focused"),n.parent||n.insAtRightEnd(e),n.selection?(n.selection.jQ.removeClass("mq-blur"),t.selectionChanged()):n.show(),t.setOverflowClasses()}).blur(function(){t.textareaSelectionTimeout&&(clearTimeout(t.textareaSelectionTimeout),t.textareaSelectionTimeout=0),t.disableGroupingForSeconds(0),t.blurred=!0,r=setTimeout(function(){e.postOrder(function(t){t.intentionalBlur()}),n.clearSelection().endSelection(),o(),t.updateMathspeak(),t.scrollHoriz()}),g(window).bind("blur",i)}),t.blurred=!0,n.hide().parent.blur(n)},Bn.prototype.unbindFocusBlurEvents=function(){this.getTextareaOrThrow().unbind("focus blur")},Rt=Bn,J=!1,__extends(q,Zt=z),q.prototype.keystroke=function(t,e,n){var r=n.cursor;switch(t){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":n.ctrlDeleteDir(b);break;case"Shift-Backspace":case"Backspace":n.backspace();break;case"Esc":case"Tab":return void n.escapeDir(1,t,e);case"Shift-Tab":case"Shift-Esc":return void n.escapeDir(b,t,e);case"End":n.notify("move").cursor.insAtRightEnd(r.parent),n.aria.queue("end of").queue(r.parent,!0);break;case"Ctrl-End":n.notify("move").cursor.insAtRightEnd(n.root),n.aria.queue("end of").queue(n.ariaLabel).queue(n.root).queue(n.ariaPostLabel);break;case"Shift-End":n.selectToBlockEndInDir(1);break;case"Ctrl-Shift-End":n.selectToRootEndInDir(1);break;case"Home":n.notify("move").cursor.insAtLeftEnd(r.parent),n.aria.queue("beginning of").queue(r.parent,!0);break;case"Ctrl-Home":n.notify("move").cursor.insAtLeftEnd(n.root),n.aria.queue("beginning of").queue(n.ariaLabel).queue(n.root).queue(n.ariaPostLabel);break;case"Shift-Home":n.selectToBlockEndInDir(b);break;case"Ctrl-Shift-Home":n.selectToRootEndInDir(b);break;case"Left":n.moveLeft();break;case"Shift-Left":n.selectLeft();break;case"Ctrl-Left":break;case"Right":n.moveRight();break;case"Shift-Right":n.selectRight();break;case"Ctrl-Right":break;case"Up":n.moveUp();break;case"Down":n.moveDown();break;case"Shift-Up":n.withIncrementalSelection(function(t){if(r[b])for(;r[b];)t(b);else t(b)});break;case"Shift-Down":n.withIncrementalSelection(function(t){if(r[1])for(;r[1];)t(1);else t(1)});break;case"Ctrl-Up":case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":n.ctrlDeleteDir(1);break;case"Shift-Del":case"Del":n.deleteForward();break;case"Meta-A":case"Ctrl-A":n.selectAll();break;case"Ctrl-Alt-Up":r.parent.parent&&r.parent.parent instanceof q?n.aria.queue(r.parent.parent):n.aria.queue("nothing above");break;case"Ctrl-Alt-Down":r.parent&&r.parent instanceof q?n.aria.queue(r.parent):n.aria.queue("block is empty");break;case"Ctrl-Alt-Left":r.parent.parent&&r.parent.parent.ends&&r.parent.parent.ends[b]&&r.parent.parent.ends[b]instanceof q?n.aria.queue(r.parent.parent.ends[b]):n.aria.queue("nothing to the left");break;case"Ctrl-Alt-Right":r.parent.parent&&r.parent.parent.ends&&r.parent.parent.ends[1]&&r.parent.parent.ends[1]instanceof q?n.aria.queue(r.parent.parent.ends[1]):n.aria.queue("nothing to the right");break;case"Ctrl-Alt-Shift-Down":r.selection?n.aria.queue(r.selection.join("mathspeak"," ").trim()+" selected"):n.aria.queue("nothing selected");break;case"Ctrl-Alt-=":case"Ctrl-Alt-Shift-Right":n.ariaPostLabel.length?n.aria.queue(n.ariaPostLabel):n.aria.queue("no answer");break;default:return}n.aria.alert(),e.preventDefault(),n.scrollHoriz()},q.prototype.moveOutOf=function(t,e,n){p("overridden or never called on this node")},q.prototype.moveTowards=function(t,e,n){p("overridden or never called on this node")},q.prototype.deleteOutOf=function(t,e){p("overridden or never called on this node")},q.prototype.deleteTowards=function(t,e){p("overridden or never called on this node")},q.prototype.unselectInto=function(t,e){p("overridden or never called on this node")},q.prototype.selectOutOf=function(t,e){p("overridden or never called on this node")},q.prototype.selectTowards=function(t,e){p("overridden or never called on this node")},s=q,$.onNotify(function(t,e){"move"!==e&&"upDown"!==e||t.show().clearSelection()}),U.leftRightIntoCmdGoes=function(t){if(t&&"up"!==t&&"down"!==t)throw'"up" or "down" required for leftRightIntoCmdGoes option, got "'+t+'"';return t},$.onNotify(function(t,e){"upDown"!==e&&(t.upDownCache={})}),$.onNotify(function(t,e){"edit"===e&&t.show().deleteSelection()}),$.onNotify(function(t,e){"select"!==e&&t.endSelection()}),__extends(k,Yt=Rt),k.prototype.keystroke=function(t,e){this.cursor.parent.keystroke(t,e,this.getControllerSelf())},k.prototype.escapeDir=function(t,e,n){d(t);var r=this.cursor;if(r.parent!==this.root&&n.preventDefault(),r.parent!==this.root)return r.parent.moveOutOf(t,r),r.controller.aria.alert(),this.notify("move")},k.prototype.moveDir=function(t){var e,n,r;return d(t),n=(e=this.cursor).options.leftRightIntoCmdGoes,r=e[t],e.selection?e.insDirOf(t,e.selection.ends[t]):r?r.moveTowards(t,e,n):e.parent.moveOutOf(t,e,n),this.notify("move")},k.prototype.moveLeft=function(){return this.moveDir(b)},k.prototype.moveRight=function(){return this.moveDir(1)},k.prototype.moveUp=function(){return this.moveUpDown("up")},k.prototype.moveDown=function(){return this.moveUpDown("down")},k.prototype.moveUpDown=function(t){var e,n=this.notify("upDown").cursor,r="up"===t?(e="upInto","upOutOf"):(e="downInto","downOutOf"),t=n[b],i=n[1],i=i&&i[e],t=t&&t[e];return i?n.insAtLeftEnd(i):t?n.insAtRightEnd(t):n.parent.bubble(function(t){var e=t[r];if(e&&((e="function"==typeof e?e.call(t,n):e)instanceof s&&n.jumpUpDown(t,e),!0!==e))return!1}),this},k.prototype.deleteDir=function(t){var e,n,r,i;return d(t),i=(e=this.cursor)[t],r=e.parent.parent,n=e.controller,i&&i instanceof s?i.sides?n.aria.queue(i.parent.chToCmd(i.sides[-t].ch).mathspeak({createdLeftOf:e})):i.blocks||"\\text"===i.parent.ctrlSeq||n.aria.queue(i):r&&r instanceof s&&(r.sides?n.aria.queue(r.parent.chToCmd(r.sides[t].ch).mathspeak({createdLeftOf:e})):r.blocks&&r.mathspeakTemplate?r.upInto&&r.downInto?n.aria.queue(r.mathspeakTemplate[1]):(i=r.mathspeakTemplate,i=t===b?i[0]:i[i.length-1],n.aria.queue(i)):n.aria.queue(r)),i=e.selection,this.notify("edit"),i||((n=e[t])?n.deleteTowards(t,e):e.parent.deleteOutOf(t,e)),r=e[b],i=e[1],r.siblingDeleted&&r.siblingDeleted(e.options,1),i.siblingDeleted&&i.siblingDeleted(e.options,b),e.parent.bubble(function(t){t.reflow()}),this},k.prototype.ctrlDeleteDir=function(t){var e,n;return d(t),!(e=this.cursor)[t]||e.selection?this.deleteDir(t):(this.notify("edit"),n=t===b?new y(e.parent.ends[b],e[b]):new y(e[1],e.parent.ends[1]),e.controller.aria.queue(n),n.remove(),e.insAtDirEnd(t,e.parent),n=e[b],t=e[1],n&&n.siblingDeleted(e.options,1),t&&t.siblingDeleted(e.options,b),e.parent.bubble(function(t){t.reflow()}),this)},k.prototype.backspace=function(){return this.deleteDir(b)},k.prototype.deleteForward=function(){return this.deleteDir(1)},k.prototype.startIncrementalSelection=function(){p("Multiple selections can't be simultaneously open",!J),J=!0,this.notify("select");var t=this.cursor;t.anticursor||t.startSelection()},k.prototype.selectDirIncremental=function(t){var e,n,r;p("A selection is open",J),J=!0,n=(e=this.cursor).selection,d(t),(r=e[t])?n&&n.ends[t]===r&&e.anticursor[-t]!==r?r.unselectInto(t,e):r.selectTowards(t,e):e.parent.selectOutOf(t,e)},k.prototype.finishIncrementalSelection=function(){var t,e;p("A selection is open",J),(t=this.cursor).clearSelection(),t.select()||t.show(),(e=t.selection)&&t.controller.aria.clear().queue(e.join("mathspeak"," ").trim()+" selected"),J=!1},k.prototype.withIncrementalSelection=function(t){var e=this;try{this.startIncrementalSelection();try{t(function(t){return e.selectDirIncremental(t)})}finally{this.finishIncrementalSelection()}}finally{J=!1}},k.prototype.selectDir=function(e){this.withIncrementalSelection(function(t){return t(e)})},k.prototype.selectLeft=function(){return this.selectDir(b)},k.prototype.selectRight=function(){return this.selectDir(1)},k.prototype.selectAll=function(){this.notify("move");var e=this.cursor;e.insAtRightEnd(this.root),this.withIncrementalSelection(function(t){for(;e[b];)t(b)})},k.prototype.selectToBlockEndInDir=function(e){var n=this.cursor;this.withIncrementalSelection(function(t){for(;n[e];)t(e)})},k.prototype.selectToRootEndInDir=function(e){var n=this,r=this.cursor;this.withIncrementalSelection(function(t){for(;r[e]||r.parent!==n.root;)t(e)})},Rt=k,__extends(In,Xt=s),Jt=c.string,re=c.regex,oe=c.letter,ae=c.digit,ie=c.any,te=c.optWhitespace,ee=c.succeed,ne=c.fail,oe=oe.map(function(t){return new nr(t)}),ae=ae.map(function(t){return new ct(t)}),le=re(/^[^${}\\_^]/).map(function(t){return new rt(t)}),re=re(/^[^\\a-eg-zA-Z]/).or(Jt("\\").then(re(/^[a-z]+/i).or(re(/^\s+/).result(" ")).or(ie))).then(function(t){var e=u[t];return e?(e.constructor?new e(t):e(t)).parser():ne("unknown command: \\"+t)}).or(oe).or(ae).or(le),ie=Jt("{").then(function(){return se}).skip(Jt("}")),oe=te.then(ie.or(re.map(function(t){var e=new l;return t.adopt(e,0,0),e}))),se=oe.many().map(Mn).skip(te),ae=Jt("[").then(oe.then(function(t){return"]"!==t.join("latex")?ee(t):ne("")}).many().map(Mn).skip(te)).skip(Jt("]")),(le=se).block=oe,le.optBlock=ae,f=le,U.maxDepth=function(t){return"number"==typeof t?t:void 0},__extends(Rn,pe=Rt),Rn.prototype.cleanLatex=function(t){return t.replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},Rn.prototype.exportLatex=function(){return this.cleanLatex(this.root.latex())},Rn.prototype.writeLatex=function(t){var e=this.notify("edit").cursor;return e.parent.writeLatex(e,t),this},Rn.prototype.classifyLatexForEfficientUpdate=function(t){var e;return"string"==typeof t&&(e=t.match(/-?[0-9.]+$/g))&&1===e.length?{latex:t,prefix:t.substr(0,t.length-e[0].length),digits:e[0]}:void 0},Rn.prototype.renderLatexMathEfficiently=function(t){var e,n,r,i,o,s,a,l,p,c,u,h,f,d=this.root,m=this.exportLatex();if(!d.ends[b]||!d.ends[1]||m!==t){if(!(h=this.classifyLatexForEfficientUpdate(t)))return!1;if(!(m=this.classifyLatexForEfficientUpdate(m))||m.prefix!==h.prefix)return!1;for(e=m.digits,n=h.digits,h=m=!1,"-"===e[0]&&(m=!0,e=e.substr(1)),"-"===n[0]&&(h=!0,n=n.substr(1)),r=this.root.ends[1],i=[],o=e.length-1;0<=o;o--){if(!r||r.ctrlSeq!==e[o])return!1;if(r.parent!==d)return!1;i.unshift(r),r=r[b]}if(m&&!h){if(!(f=r))return!1;if("-"!==f.ctrlSeq)return!1;if(f[1]!==i[0])return!1;if(f.parent!==d)return!1;if((s=f[b])&&s.parent!==d)return!1;i[0][b]=f[b],d.ends[b]===f&&(d.ends[b]=i[0]),s&&(s[1]=i[0]),f.jQ.remove()}for(!m&&h&&(s=new mt("-"),(f=document.createElement("span")).textContent="-",s.jQ=g(f),(m=i[0][b])&&(m[1]=s),d.ends[b]===i[0]&&(d.ends[b]=s),s.parent=d,s[b]=i[0][b],s[1]=i[0],(i[0][b]=s).contactWeld(this.cursor),s.jQ.insertBefore(i[0].jQ)),a=Math.min(e.length,n.length),o=0;o<a;o++)l=n[o],(r=i[o]).ctrlSeq!==l&&(r.ctrlSeq=l,r.jQ[0].textContent=l,r.mathspeakName=l);if(e.length>n.length)for(r=i[n.length-1],(d.ends[1]=r)[1]=0,o=e.length-1;a<=o;o--)i[o].jQ.remove();if(n.length>e.length){for(p=document.createDocumentFragment(),o=a;o<n.length;o++)(c=document.createElement("span")).className="mq-digit",c.textContent=n[o],(u=new ct(n[o])).parent=d,u.jQ=g(c),p.appendChild(c),u[b]=d.ends[1],u[1]=0,u[b][1]=u,d.ends[1]=u;d.jQ[0].appendChild(p)}if((h=this.exportLatex())!==t)return console.warn("tried updating latex efficiently but did not work. Attempted: "+t+" but wrote: "+h),!1;this.cursor.resetToEnd(this),(f=d.ends[1])&&f.fixDigitGrouping(this.cursor.options)}return!0},Rn.prototype.renderLatexMathFromScratch=function(t){var e=this.root,n=this.cursor,r=c.all,i=c.eof,i=f.skip(i).or(r.result(!1)).parse(t);e.ends[b]=e.ends[1]=0,i&&i.children().adopt(e,0,0),r=e.jQ,i?(t=i.join("html"),r.html(t),e.jQize(r.children()),e.finalizeInsert(n.options,n)):r.empty(),this.updateMathspeak(),delete n.selection,n.insAtRightEnd(e)},Rn.prototype.renderLatexMath=function(t){this.notify("replace"),this.renderLatexMathEfficiently(t)||this.renderLatexMathFromScratch(t)},Rn.prototype.renderLatexText=function(t){var e,n,r,i,o,s,a,l=this.root,p=this.cursor;if(l.jQ.children().slice(1).remove(),l.ends[b]=l.ends[1]=0,delete p.selection,p.show().insAtRightEnd(l),e=c.regex,o=c.string,n=c.eof,r=c.all,i=o("$").then(f).skip(o("$").or(n)).map(function(t){var e,n=new at(p);return n.createBlocks(),e=n.ends[b],t.children().adopt(e,0,0),n}),o=o("\\$").result("$").or(e(/^[^$]/)).map(function(t){return new rt(t)}),s=i.or(o).many().skip(n).or(r.result(!1)).parse(t)){for(a=0;a<s.length;a+=1)s[a].adopt(l,l.ends[1],0);l.jQize().appendTo(l.jQ),l.finalizeInsert(p.options,p)}},ie=Rn,h.prototype.ignoreNextMousedown=tt=function(t){return!1},$.onNotify(function(t,e){"edit"!==e&&"replace"!==e||et&&et.cursor===t&&et.cb()}),__extends(zn,ce=ie),zn.prototype.delegateMouseEvents=function(){var d=this.root.jQ;this.container.bind("mousedown.mathquill",function(t){var e,n,r,i,o,s,a,l;function p(t){a=g(t.target)}function c(t){i.anticursor||i.startSelection(),r.seek(a,t.pageX,t.pageY).cursor.select(),i.selection&&i.controller.aria.clear().queue(i.selection.join("mathspeak")+" selected").alert(),a=void 0}function u(t){n.unbind("mousemove",p);t=t.target;g(t.ownerDocument).unbind("mousemove",c).unbind("mouseup",f),et=void 0}function h(){r.editable?(i.show(),i.controller.aria.queue(i.parent).alert()):s.detach()}function f(t){i.blink=o,i.selection||h(),u(t)}n=g((e=t).target).closest(".mq-root-block"),t=z.getNodeOfElement(n[0])||z.getNodeOfElement(d[0]),r=t.controller,i=r.cursor,o=i.blink,s=r.getTextareaSpanOrThrow(),t=r.getTextareaOrThrow(),e.preventDefault(),e.target.unselectable=!0,i.options.ignoreNextMousedown(e)||(i.options.ignoreNextMousedown=tt,et={cursor:i,cb:function(){l=!0,i.blink=o,i.clearSelection(),h(),u(e)}},r.blurred&&(r.editable||n.prepend(s),t[0].focus(),l))||(i.blink=bn,r.seek(g(e.target),e.pageX,e.pageY).cursor.startSelection(),n.mousemove(p),t=e.target,g(t.ownerDocument).mousemove(c).mouseup(f))})},zn.prototype.seek=function(t,e,n){for(var r,i=this.notify("select").cursor,o=t&&t[0];o&&!(r=z.getNodeOfElement(o));)o=o.parentElement;return r=r||this.root,i.clearSelection().show(),r.seek(e,i),this.scrollHoriz(),this},__extends(Nn,ue=zn),Nn.prototype.setOverflowClasses=function(){var t,e,n=this.root.jQ[0],r=!1,i=!1;this.blurred||(e=n.getBoundingClientRect().width,t=n.scrollWidth,r=e+(e=n.scrollLeft)<t,i=0<e),n.classList.contains("mq-editing-overflow-right")!==r&&n.classList.toggle("mq-editing-overflow-right"),n.classList.contains("mq-editing-overflow-left")!==i&&n.classList.toggle("mq-editing-overflow-left")},Nn.prototype.scrollHoriz=function(){var t,e,n,r,i=this,o=this.cursor,s=o.selection,a=this.root.jQ[0].getBoundingClientRect();if(o.jQ[0]||s){if(s)if(e=(r=s.jQ[0].getBoundingClientRect()).left-(a.left+20),n=r.right-(a.right-20),s.ends[b]===o[1])if(e<0)t=e;else{if(!(0<n))return;t=r.left-n<a.left+20?e:n}else if(0<n)t=n;else{if(!(e<0))return;t=r.right-e>a.right-20?n:e}else if((s=o.jQ[0].getBoundingClientRect().left)>a.right-20)t=s-(a.right-20);else{if(!(s<a.left+20))return;t=s-(a.left+20)}r=this.root.jQ[0],t<0&&0===r.scrollLeft||0<t&&r.scrollWidth<=r.scrollLeft+a.width||this.root.jQ.stop().animate({scrollLeft:"+="+t},100,function(){i.setOverflowClasses()})}else this.root.jQ.stop().animate({scrollLeft:0},100,function(){i.setOverflowClasses()})},re=Nn,h.prototype.substituteTextarea=function(){return g("<textarea autocapitalize=off autocomplete=off autocorrect=off spellcheck=false x-palm-disable-ste-all=true/>")[0]},h.prototype.substituteKeyboardEvents=X,__extends(_,he=re),_.prototype.createTextarea=function(){var t,e=this.textareaSpan=g('<span class="mq-textarea"></span>'),n=this.options.substituteTextarea();if(!n.nodeType)throw"substituteTextarea() must return a DOM element, got "+n;this.textarea=g(n).appendTo(e),this.aria.setContainer(this.textareaSpan),(t=this).cursor.selectionChanged=function(){t.selectionChanged()}},_.prototype.selectionChanged=function(){var t=this;t.textareaSelectionTimeout||(t.textareaSelectionTimeout=setTimeout(function(){t.setTextareaSelection()}))},_.prototype.setTextareaSelection=function(){this.textareaSelectionTimeout=0;var t="";this.cursor.selection&&(t=this.cleanLatex(this.cursor.selection.join("latex")),this.options.statelessClipboard)&&(t="$"+t+"$"),this.selectFn(t)},_.prototype.staticMathTextareaEvents=function(){var t,e,n,r;function i(){r.detach(),t.blurred=!0}e=(t=this).cursor,n=t.getTextareaOrThrow(),r=t.getTextareaSpanOrThrow(),this.container.prepend(gn('<span aria-hidden="true" class="mq-selectable">').text("$"+t.exportLatex()+"$")),this.mathspeakSpan=g('<span class="mq-mathspeak"></span>'),this.container.prepend(this.mathspeakSpan),t.blurred=!0,n.bind("cut paste",!1),t.options.disableCopyPaste?n.bind("copy",!1):n.bind("copy",function(){t.setTextareaSelection()}),n.focus(function(){t.blurred=!1}).blur(function(){e.selection&&e.selection.clear(),setTimeout(i)}),t.selectFn=function(t){n.val(t),t&&n.select()},this.updateMathspeak()},_.prototype.editablesTextareaEvents=function(){var t=this.getTextareaOrThrow(),e=this.getTextareaSpanOrThrow(),n=this.options.substituteKeyboardEvents(t,this);this.selectFn=function(t){n.select(t)},this.container.prepend(e),this.focusBlurEvents(),this.updateMathspeak()},_.prototype.unbindEditablesEvents=function(){var e=this.getTextareaOrThrow(),t=this.getTextareaSpanOrThrow();this.selectFn=function(t){e.val(t),t&&e.select()},t.remove(),this.unbindFocusBlurEvents(),this.blurred=!0,e.bind("cut paste",!1)},_.prototype.typedText=function(t){if("\n"===t)return this.handle("enter");var e=this.notify(void 0).cursor;e.parent.write(e,t),this.scrollHoriz()},_.prototype.cut=function(){var t=this,e=t.cursor;e.selection&&setTimeout(function(){t.notify("edit"),e.parent.bubble(function(t){t.reflow()}),t.options&&t.options.onCut&&t.options.onCut()})},_.prototype.copy=function(){this.setTextareaSelection()},_.prototype.paste=function(t){this.options.statelessClipboard&&(t="$"===t.slice(0,1)&&"$"===t.slice(-1)?t.slice(1,-1):"\\text{"+t+"}"),this.writeLatex(t).cursor.show(),this.scrollHoriz(),this.options&&this.options.onPaste&&this.options.onPaste()},_.prototype.updateMathspeak=function(){var t,e=this,n=e.getAriaLabel(),n=/[A-Za-z0-9]$/.test(n)?n+":":n,r=e.root.mathspeak().trim();this.aria.clear(),t=e.getTextareaOrThrow(),e.mathspeakSpan?(t.attr("aria-label",""),e.mathspeakSpan.text((n+" "+r).trim())):t.attr("aria-label",(n+" "+r+" "+e.ariaPostLabel).trim())},nt=_,__extends(Fn,fe=s),Fn.prototype.finalizeInsert=function(e,n){var t,r,i=this;i.postOrder(function(t){t.finalizeTree(e)}),i.postOrder(function(t){t.contactWeld(n)}),i.postOrder(function(t){t.blur(n)}),i.postOrder(function(t){t.reflow()}),t=i[1],r=i[b],t&&t.siblingCreated(e,b),r&&r.siblingCreated(e,1),i.bubble(function(t){t.reflow()})},Fn.prototype.prepareInsertionAt=function(t){var e=t.options.maxDepth;if(void 0!==e){if(e<(t=t.depth()))return!1;this.removeNodesDeeperThan(e-t)}return!0},Fn.prototype.removeNodesDeeperThan=function(n){for(var t,r,i=0,o=[[this,i]];t=o.shift();)(r=t)[0].children().each(function(t){var e=t instanceof l?1:0;(i=r[1]+e)<=n?o.push([t,i]):(e?t.children():t).remove()})},__extends(S,de=te=Fn),S.prototype.setCtrlSeqHtmlAndText=function(t,e,n){this.ctrlSeq||(this.ctrlSeq=t),e&&(this.htmlTemplate=e),n&&(this.textTemplate=n)},S.prototype.replaces=function(t){t.disown(),this.replacedFragment=t},S.prototype.isEmpty=function(){return this.foldChildren(!0,function(t,e){return t&&e.isEmpty()})},S.prototype.parser=function(){var n=this;return f.block.times(this.numBlocks()).map(function(t){n.blocks=t;for(var e=0;e<t.length;e+=1)t[e].adopt(n,n.ends[1],0);return n})},S.prototype.createLeftOf=function(t){var e,n=this,r=n.replacedFragment;n.createBlocks(),de.prototype.createLeftOf.call(this,t),r&&(e=n.ends[b],r.adopt(e,0,0),r.jQ.appendTo(e.jQ),n.placeCursor(t),n.prepareInsertionAt(t)),n.finalizeInsert(t.options,t),n.placeCursor(t)},S.prototype.createBlocks=function(){for(var t=this.numBlocks(),e=this.blocks=Array(t),n=0;n<t;n+=1)(e[n]=new l).adopt(this,this.ends[1],0)},S.prototype.placeCursor=function(t){t.insAtRightEnd(this.foldChildren(this.ends[b],function(t,e){return t.isEmpty()?t:e}))},S.prototype.moveTowards=function(t,e,n){var r;"up"===n?r=this.upInto:"down"===n&&(r=this.downInto),n=r||this.ends[-t],e.insAtDirEnd(-t,n),e.controller.aria.queueDirEndOf(-t).queue(e.parent,!0)},S.prototype.deleteTowards=function(t,e){this.isEmpty()?e[t]=this.remove()[t]:this.moveTowards(t,e)},S.prototype.selectTowards=function(t,e){e[-t]=this,e[t]=this[t]},S.prototype.selectChildren=function(){return new P(this,this)},S.prototype.unselectInto=function(t,e){var n=e.anticursor.ancestors[this.id];e.insAtDirEnd(-t,n)},S.prototype.seek=function(n,r){var i,o,s;function a(t){var e=t.jQ.offset().left,t=e+t.jQ.outerWidth(),n={};return n[b]=e,n[1]=t,n}return o=a(i=this),n<o[b]?r.insLeftOf(i):n>o[1]?r.insRightOf(i):(s=o[b],void i.eachChild(function(t){var e=a(t);return n<e[b]?(n-s<e[b]-n?t[b]?r.insAtRightEnd(t[b]):r.insLeftOf(i):r.insAtLeftEnd(t),!1):n>e[1]?void(t[1]?s=e[1]:o[1]-n<n-e[1]?r.insRightOf(i):r.insAtRightEnd(t)):(t.seek(n,r),!1)}))},S.prototype.numBlocks=function(){var t=this.htmlTemplate.match(/&\d+/g);return t?t.length:0},S.prototype.html=function(){var t,e,n,r=this.blocks,i=" mathquill-command-id="+this.id,o=this.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);for(p("no unmatched angle brackets",o.join("")===this.htmlTemplate),e=o[t=0];e;e=o[t+=1])if("/>"===e.slice(-2))o[t]=e.slice(0,-2)+i+' aria-hidden="true"/>';else if("<"===e.charAt(0))for(p("not an unmatched top-level close tag","/"!==e.charAt(1)),o[t]=e.slice(0,-1)+i+' aria-hidden="true">',n=1;p("no missing close tags",e=o[t+=1]),"</"===e.slice(0,2)?--n:"<"===e.charAt(0)&&"/>"!==e.slice(-2)&&(n+=1),0<n;);return o.join("").replace(/>&(\d+)/g,function(t,e){e=parseInt(e,10);return" mathquill-block-id="+r[e].id+' aria-hidden="true">'+r[e].join("html")})},S.prototype.latex=function(){return this.foldChildren(this.ctrlSeq||"",function(t,e){return t+"{"+(e.latex()||" ")+"}"})},S.prototype.text=function(){var n=this,r=0;return n.foldChildren(n.textTemplate[r],function(t,e){r+=1;e=e.text();return t&&"("===n.textTemplate[r]&&"("===e[0]&&")"===e.slice(-1)?t+e.slice(1,-1)+n.textTemplate[r]:t+e+(n.textTemplate[r]||"")})},S.prototype.mathspeak=function(){var n=this,r=0;return n.foldChildren(n.mathspeakTemplate[r]||"Start"+n.ctrlSeq+" ",function(t,e){return r+=1,t+" "+e.mathspeak()+" "+(n.mathspeakTemplate[r]+" "||"End"+n.ctrlSeq+" ")})},__extends(O,me=n=S),O.prototype.setCtrlSeqHtmlTextAndMathspeak=function(t,e,n,r){!n&&t&&(n=t.replace(/^\\/,"")),this.mathspeakName=r||n,me.prototype.setCtrlSeqHtmlAndText.call(this,t,e,[n||""])},O.prototype.parser=function(){return c.succeed(this)},O.prototype.numBlocks=function(){return 0},O.prototype.replaces=function(t){t.remove()},O.prototype.createBlocks=function(){},O.prototype.moveTowards=function(t,e){e.jQ.insDirOf(t,this.jQ),e[-t]=this,e[t]=this[t],e.controller.aria.queue(this)},O.prototype.deleteTowards=function(t,e){e[t]=this.remove()[t]},O.prototype.seek=function(t,e){return t-this.jQ.offset().left<this.jQ.outerWidth()/2?e.insLeftOf(this):e.insRightOf(this),e},O.prototype.latex=function(){return this.ctrlSeq||""},O.prototype.text=function(){return this.textTemplate.join("")},O.prototype.mathspeak=function(t){return this.mathspeakName||""},O.prototype.placeCursor=function(){},O.prototype.isEmpty=function(){return!0},__extends(Pn,ge=i=O),rt=Pn,__extends($n,ye=i),a=$n,__extends(C,we=te),C.prototype.join=function(n){return this.foldChildren("",function(t,e){return t+e[n]()})},C.prototype.html=function(){return this.join("html")},C.prototype.latex=function(){return this.join("latex")},C.prototype.text=function(){var t=this.ends[b];return t===this.ends[1]&&0!==t?t.text():this.join("text")},C.prototype.mathspeak=function(){var i="",o={};return this.controller&&(o=this.controller.options.autoOperatorNames),this.foldChildren([],function(t,e){var n,r;return e.isPartOfOperator?i+=e.mathspeak():(""!==i&&(0<o._maxLength&&"string"==typeof(n=o[i.toLowerCase()])&&(i=n),t.push(i+" "),i=""),n=e.mathspeak(),r=e.ctrlSeq,!isNaN(r)||"."===r||e.parent&&e.parent.parent&&e.parent.parent.isTextBlock()||(n=" "+n+" "),t.push(n)),t}).join("").replace(/ +(?= )/g,"").replace(/(\.)([0-9]+)/g,function(t,e,n){return e+n.split("").join(" ").trim()})},C.prototype.keystroke=function(t,e,n){if(!n.options.spaceBehavesLikeTab||"Spacebar"!==t&&"Shift-Spacebar"!==t)return we.prototype.keystroke.call(this,t,e,n);e.preventDefault(),n.escapeDir("Shift-Spacebar"===t?b:1,t,e)},C.prototype.moveOutOf=function(t,e,n){var r;"up"===n?r=this.parent.upInto:"down"===n&&(r=this.parent.downInto),!r&&this[t]?(e.insAtDirEnd(n=-t,this[t]),e.controller.aria.queueDirEndOf(n).queue(e.parent,!0)):(e.insDirOf(t,this.parent),e.controller.aria.queueDirOf(t).queue(this.parent))},C.prototype.selectOutOf=function(t,e){e.insDirOf(t,this.parent)},C.prototype.deleteOutOf=function(t,e){e.unwrapGramp()},C.prototype.seek=function(t,e){var n=this.ends[1];if(!n||n.jQ.offset().left+n.jQ.outerWidth()<t)return e.insAtRightEnd(this);if(t<this.ends[b].jQ.offset().left)return e.insAtLeftEnd(this);for(;t<n.jQ.offset().left;)n=n[b];return n.seek(t,e)},C.prototype.chToCmd=function(t,e){return t.match(/^[a-eg-zA-Z]$/)?new nr(t):/^\d$/.test(t)?new ct(t):e&&e.typingSlashWritesDivisionSymbol&&"/"===t?u["÷"](t):e&&e.typingAsteriskWritesTimesSymbol&&"*"===t?u["×"](t):e&&e.typingPercentWritesPercentOf&&"%"===t?u.percentof(t):(e=o[t]||u[t])?e.constructor?new e(t):e(t):new rt(t)},C.prototype.write=function(t,e){var n=this.chToCmd(e,t.options);t.selection&&n.replaces(t.replaceSelection()),t.isTooDeep()||(n.createLeftOf(t.show()),"/"===e?t.controller.aria.alert("over"):t.controller.aria.alert(n.mathspeak({createdLeftOf:t})))},C.prototype.writeLatex=function(t,e){var n=c.all,r=c.eof,r=f.skip(r).or(n.result(!1)).parse(e);r&&!r.isEmpty()&&r.prepareInsertionAt(t)&&(r.children().adopt(t.parent,t[b],t[1]),r.jQize().insertBefore(t.jQ),t[b]=r.ends[1],r.finalizeInsert(t.options,t),n=r.ends[1],e=r.ends[b],r=n[1],n=e[b],r&&r.siblingCreated(t.options,b),n&&n.siblingCreated(t.options,1),t.parent.bubble(function(t){t.reflow()}))},C.prototype.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this},C.prototype.blur=function(t){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&(this.jQ.addClass("mq-empty"),t)&&this.isQuietEmptyDelimiter(t.options.quietEmptyDelimiters)&&this.jQ.addClass("mq-quiet-delimiter"),this},l=C,h.prototype.mouseEvents=!0,G.StaticMath=function(n){var t,r;return r=n.AbstractMathQuill,__extends(e,r),e.prototype.__mathquillify=function(t,e){return this.config(t),r.prototype.__mathquillify.call(this,"mq-math-mode"),this.__options.mouseEvents&&(this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents()),this},e.prototype.latex=function(){var e,t=r.prototype.latex.apply(this,arguments);return 0<arguments.length&&(e=this.innerFields=[],this.__controller.root.postOrder(function(t){t.registerInnerField(e,n.InnerMathField)}),this.__controller.updateMathspeak()),t},e.prototype.setAriaLabel=function(t){return this.__controller.setAriaLabel(t),this},e.prototype.getAriaLabel=function(){return this.__controller.getAriaLabel()},(t=e).RootBlock=l,t;function e(t){var t=r.call(this,t)||this,e=t.innerFields=[];return t.__controller.root.postOrder(function(t){t.registerInnerField(e,n.InnerMathField)}),t}},__extends(Gn,be=l),jn((it=Gn).prototype),G.MathField=function(t){var n;return n=t.EditableField,__extends(e,n),e.prototype.__mathquillify=function(t,e){return this.config(t),1<e&&(this.__controller.root.reflow=bn),n.prototype.__mathquillify.call(this,"mq-editable-field mq-math-mode"),delete this.__controller.root.reflow,this},(t=e).RootBlock=it,t;function e(){return null!==n&&n.apply(this,arguments)||this}},G.InnerMathField=function(t){return n=t.MathField,__extends(e,n),e.prototype.makeStatic=function(){this.__controller.editable=!1,this.__controller.root.blur(),this.__controller.unbindEditablesEvents(),this.__controller.container.removeClass("mq-editable-field")},e.prototype.makeEditable=function(){this.__controller.editable=!0,this.__controller.editablesTextareaEvents(),this.__controller.cursor.insAtRightEnd(this.__controller.root),this.__controller.container.addClass("mq-editable-field")},e;function e(){return null!==n&&n.apply(this,arguments)||this}var n},__extends(A,ve=s),A.prototype.replaces=function(t){t instanceof y?this.replacedText=t.remove().jQ.text():"string"==typeof t&&(this.replacedText=t)},A.prototype.jQadd=function(t){var e;return ve.prototype.jQadd.call(this,t),(t=this.ends[b])&&(e=this.jQ[0].firstChild)&&t.jQadd(e),this.jQ},A.prototype.createLeftOf=function(t){var e,n,r=this;if(ve.prototype.createLeftOf.call(this,t),t.insAtRightEnd(r),r.replacedText)for(e=0;e<r.replacedText.length;e+=1)r.write(t,r.replacedText.charAt(e));(n=r[1])&&n.siblingCreated(t.options,b),(n=r[b])&&n.siblingCreated(t.options,1),r.bubble(function(t){t.reflow()})},A.prototype.parser=function(){var e=this,t=c.string,n=c.regex;return c.optWhitespace.then(t("{")).then(n(/^[^}]*/)).skip(t("}")).map(function(t){return 0===t.length?new y:(new st(t).adopt(e,0,0),e)})},A.prototype.textContents=function(){return this.foldChildren("",function(t,e){return t+e.textStr})},A.prototype.text=function(){return'"'+this.textContents()+'"'},A.prototype.latex=function(){var t=this.textContents();return 0===t.length?"":this.ctrlSeq+"{"+t.replace(/\\/g,"\\backslash ").replace(/[{}]/g,"\\$&")+"}"},A.prototype.html=function(){return'<span class="mq-text-mode" mathquill-command-id='+this.id+">"+this.textContents()+"</span>"},A.prototype.mathspeak=function(t){return t&&t.ignoreShorthand?this.mathspeakTemplate[0]+", "+this.textContents()+", "+this.mathspeakTemplate[1]:this.textContents()},A.prototype.isTextBlock=function(){return!0},A.prototype.moveTowards=function(t,e){e.insAtDirEnd(-t,this),e.controller.aria.queueDirEndOf(-t).queue(e.parent,!0)},A.prototype.moveOutOf=function(t,e){e.insDirOf(t,this),e.controller.aria.queueDirOf(t).queue(this)},A.prototype.unselectInto=function(t,e){this.moveTowards(t,e)},A.prototype.selectTowards=function(t,e){n.prototype.selectTowards.call(this,t,e)},A.prototype.deleteTowards=function(t,e){n.prototype.deleteTowards.call(this,t,e)},A.prototype.selectOutOf=function(t,e){e.insDirOf(t,this)},A.prototype.deleteOutOf=function(t,e){this.isEmpty()&&e.insRightOf(this)},A.prototype.write=function(t,e){var n,r;t.show().deleteSelection(),"$"!==e?(n=t[b])?n instanceof st&&n.appendText(e):new st(e).createLeftOf(t):this.isEmpty()?(t.insRightOf(this),new rt("\\$","$").createLeftOf(t)):t[1]?t[b]?(n=new A,(r=this.ends[b])&&(r.disown().jQ.detach(),r.adopt(n,0,0)),t.insLeftOf(this),ve.prototype.createLeftOf.call(n,t)):t.insLeftOf(this):t.insRightOf(this),this.bubble(function(t){t.reflow()}),t.controller.aria.alert(e)},A.prototype.writeLatex=function(t,e){var n=t[b];n?n instanceof st&&n.appendText(e):new st(e).createLeftOf(t),this.bubble(function(t){t.reflow()})},A.prototype.seek=function(t,e){var n,r,i,o,s,a,l;if(e.hide(),a=Hn(this)){for(n=this.jQ.width()/this.text.length,(n=Math.round((t-this.jQ.offset().left)/n))<=0?e.insAtLeftEnd(this):n>=a.textStr.length?e.insAtRightEnd(this):e.insLeftOf(a.splitRight(n)),o=i=(r=t-e.show().offset().left)&&r<0?b:1;e[i]&&0<r*o;)e[i].moveTowards(i,e),o=r,r=t-e.offset().left;i*r<-i*o&&e[-i].moveTowards(-i,e),e.anticursor?e.anticursor.parent===this&&(a=(s=e[b])&&s.textStr.length,this.anticursorPosition===a?e.anticursor=N.fromCursor(e):(this.anticursorPosition<a?(l=s.splitRight(this.anticursorPosition),e[b]=l):l=e[1].splitRight(this.anticursorPosition-a),e.anticursor=new N(this,l[b],l))):(s=e[b],this.anticursorPosition=s&&s.textStr.length)}},A.prototype.blur=function(t){l.prototype.blur.call(this,t),t&&(""===this.textContents()?(this.remove(),t[b]===this?t[b]=this[b]:t[1]===this&&(t[1]=this[1])):Hn(this))},A.prototype.focus=function(){l.prototype.focus.call(this)},ot=A,__extends(j,xe=s),j.prototype.jQadd=function(t){return this.dom=t,this.jQ=g(t),this.jQ},j.prototype.jQize=function(){return this.jQadd(document.createTextNode(this.textStr))},j.prototype.appendText=function(t){this.textStr+=t,this.dom.appendData(t)},j.prototype.prependText=function(t){this.textStr=t+this.textStr,this.dom.insertData(0,t)},j.prototype.insTextAtDirEnd=function(t,e){d(e),1===e?this.appendText(t):this.prependText(t)},j.prototype.splitRight=function(t){var e=new j(this.textStr.slice(t)).adopt(this.parent,this,this[1]);return e.jQadd(this.dom.splitText(t)),this.textStr=this.textStr.slice(0,t),e},j.prototype.endChar=function(t,e){return e.charAt(t===b?0:-1+e.length)},j.prototype.moveTowards=function(t,e){var n,r;return d(t),n=this.endChar(-t,this.textStr),(r=this[-t])instanceof j?r.insTextAtDirEnd(n,t):new j(n).createDir(-t,e),this.deleteTowards(t,e)},j.prototype.mathspeak=function(){return this.textStr},j.prototype.latex=function(){return this.textStr},j.prototype.deleteTowards=function(t,e){var n;1<this.textStr.length?(1===t?(this.dom.deleteData(0,1),n=this.textStr[0],this.textStr=this.textStr.slice(1)):(this.dom.deleteData(-1+this.textStr.length,1),n=this.textStr[this.textStr.length-1],this.textStr=this.textStr.slice(0,-1)),e.controller.aria.queue(n)):(this.remove(),this.jQ.remove(),e[t]=this[t],e.controller.aria.queue(this.textStr))},j.prototype.selectTowards=function(t,e){var n,r,i,o;if(d(t),n=e.anticursor)return r=this.endChar(-t,this.textStr),n[t]===this?(i=new j(r).createDir(t,e),n[t]=i,e.insDirOf(t,i)):((o=this[-t])instanceof j?o.insTextAtDirEnd(r,t):(i=new j(r).createDir(-t,e),(o=e.selection)&&i.jQ.insDirOf(-t,o.jQ)),1===this.textStr.length&&n[-t]===this&&(n[-t]=this[-t])),this.deleteTowards(t,e)},st=j,u.text=u.textnormal=u.textrm=u.textup=u.textmd=ot,u.em=u.italic=u.italics=u.emph=u.textit=u.textsl=Un("\\textit","Italic","i",'class="mq-text-mode"'),u.strong=u.bold=u.textbf=Un("\\textbf","Bold","b",'class="mq-text-mode"'),u.sf=u.textsf=Un("\\textsf","Sans serif font","span",'class="mq-sans-serif mq-text-mode"'),u.tt=u.texttt=Un("\\texttt","Mono space font","span",'class="mq-monospace mq-text-mode"'),u.textsc=Un("\\textsc","Variable font","span",'style="font-variant:small-caps" class="mq-text-mode"'),u.uppercase=Un("\\uppercase","Uppercase","span",'style="text-transform:uppercase" class="mq-text-mode"'),u.lowercase=Un("\\lowercase","Lowercase","span",'style="text-transform:lowercase" class="mq-text-mode"'),__extends(Wn,qe=n),Wn.prototype.createBlocks=function(){qe.prototype.createBlocks.call(this);var t=this.ends[b];t.cursor=this.cursor,t.write=function(t,e){"$"!==e?l.prototype.write.call(this,t,e):this.isEmpty()?(t.insRightOf(this.parent),this.parent.deleteTowards(void 0,t),new rt("\\$","$").createLeftOf(t.show())):t[1]?t[b]?l.prototype.write.call(this,t,e):t.insLeftOf(this.parent):t.insRightOf(this.parent)}},Wn.prototype.latex=function(){return"$"+this.ends[b].latex()+"$"},at=Wn,__extends(Vn,ke=it),Vn.prototype.keystroke=function(t,e,n){if("Spacebar"!==t&&"Shift-Spacebar"!==t)return ke.prototype.keystroke.call(this,t,e,n)},Vn.prototype.write=function(t,e){var n;t.show().deleteSelection(),("$"===e?new at(t):("<"===e?n="&lt;":">"===e&&(n="&gt;"),new rt(e,n))).createLeftOf(t)},lt=Vn,G.TextField=function(t){var e;return e=t.EditableField,__extends(n,e),n.prototype.__mathquillify=function(){return e.prototype.__mathquillify.call(this,"mq-editable-field mq-text-mode")},n.prototype.latex=function(t){return 0<arguments.length?(this.__controller.renderLatexText(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},(t=n).RootBlock=lt,t;function n(){return null!==e&&e.apply(this,arguments)||this}},u.notin=u.cong=u.equiv=u.oplus=u.otimes=function(t){return new a("\\"+t+" ","&"+t+";")},u["∗"]=u.ast=u.star=u.loast=u.lowast=T("\\ast ","&lowast;","low asterisk"),u.therefor=u.therefore=T("\\therefore ","&there4;","therefore"),u.cuz=u.because=T("\\because ","&#8757;","because"),u.prop=u.propto=T("\\propto ","&prop;","proportional to"),u["≈"]=u.asymp=u.approx=T("\\approx ","&asymp;","approximately equal to"),u.isin=u.in=T("\\in ","&isin;","is in"),u.ni=u.contains=T("\\ni ","&ni;","is not in"),u.notni=u.niton=u.notcontains=u.doesnotcontain=T("\\not\\ni ","&#8716;","does not contain"),u.sub=u.subset=T("\\subset ","&sub;","subset"),u.sup=u.supset=u.superset=T("\\supset ","&sup;","superset"),u.nsub=u.notsub=u.nsubset=u.notsubset=T("\\not\\subset ","&#8836;","not a subset"),u.nsup=u.notsup=u.nsupset=u.notsupset=u.nsuperset=u.notsuperset=T("\\not\\supset ","&#8837;","not a superset"),u.sube=u.subeq=u.subsete=u.subseteq=T("\\subseteq ","&sube;","subset or equal to"),u.supe=u.supeq=u.supsete=u.supseteq=u.supersete=u.superseteq=T("\\supseteq ","&supe;","superset or equal to"),u.nsube=u.nsubeq=u.notsube=u.notsubeq=u.nsubsete=u.nsubseteq=u.notsubsete=u.notsubseteq=T("\\not\\subseteq ","&#8840;","not subset or equal to"),u.nsupe=u.nsupeq=u.notsupe=u.notsupeq=u.nsupsete=u.nsupseteq=u.notsupsete=u.notsupseteq=u.nsupersete=u.nsuperseteq=u.notsupersete=u.notsuperseteq=T("\\not\\supseteq ","&#8841;","not superset or equal to"),u.mathbb=(__extends(Kn,_e=n),Kn.prototype.createLeftOf=function(t){},Kn.prototype.numBlocks=function(){return 1},Kn.prototype.parser=function(){var t=c.string,e=c.regex,n=c.optWhitespace;return n.then(t("{")).then(n).then(e(/^[NPZQRCH]/)).skip(n).skip(t("}")).map(function(t){t=u[t];return On(t)?new t:t()})},Kn),u.N=u.naturals=u.Naturals=L("\\mathbb{N}","&#8469;","naturals"),u.P=u.primes=u.Primes=u.projective=u.Projective=u.probability=u.Probability=L("\\mathbb{P}","&#8473;","P"),u.Z=u.integers=u.Integers=L("\\mathbb{Z}","&#8484;","integers"),u.Q=u.rationals=u.Rationals=L("\\mathbb{Q}","&#8474;","rationals"),u.R=u.reals=u.Reals=L("\\mathbb{R}","&#8477;","reals"),u.C=u.complex=u.Complex=u.complexes=u.Complexes=u.complexplane=u.Complexplane=u.ComplexPlane=L("\\mathbb{C}","&#8450;","complexes"),u.H=u.Hamiltonian=u.quaternions=u.Quaternions=L("\\mathbb{H}","&#8461;","quaternions"),u.quad=u.emsp=L("\\quad ","    ","4 spaces"),u.qquad=L("\\qquad ","        ","8 spaces"),u.diamond=L("\\diamond ","&#9671;","diamond"),u.bigtriangleup=L("\\bigtriangleup ","&#9651;","triangle up"),u.ominus=L("\\ominus ","&#8854;","o minus"),u.uplus=L("\\uplus ","&#8846;","disjoint union"),u.bigtriangledown=L("\\bigtriangledown ","&#9661;","triangle down"),u.sqcap=L("\\sqcap ","&#8851;","greatest lower bound"),u.triangleleft=L("\\triangleleft ","&#8882;","triangle left"),u.sqcup=L("\\sqcup ","&#8852;","least upper bound"),u.triangleright=L("\\triangleright ","&#8883;","triangle right"),u.odot=u.circledot=L("\\odot ","&#8857;","circle dot"),u.bigcirc=L("\\bigcirc ","&#9711;","circle"),u.dagger=L("\\dagger ","&#0134;","dagger"),u.ddagger=L("\\ddagger ","&#135;","big dagger"),u.wr=L("\\wr ","&#8768;","wreath"),u.amalg=L("\\amalg ","&#8720;","amalgam"),u.models=L("\\models ","&#8872;","models"),u.prec=L("\\prec ","&#8826;","precedes"),u.succ=L("\\succ ","&#8827;","succeeds"),u.preceq=L("\\preceq ","&#8828;","precedes or equals"),u.succeq=L("\\succeq ","&#8829;","succeeds or equals"),u.simeq=L("\\simeq ","&#8771;","similar or equal to"),u.mid=L("\\mid ","&#8739;","divides"),u.ll=L("\\ll ","&#8810;","ll"),u.gg=L("\\gg ","&#8811;","gg"),u.parallel=L("\\parallel ","&#8741;","parallel with"),u.nparallel=L("\\nparallel ","&#8742;","not parallel with"),u.bowtie=L("\\bowtie ","&#8904;","bowtie"),u.sqsubset=L("\\sqsubset ","&#8847;","square subset"),u.sqsupset=L("\\sqsupset ","&#8848;","square superset"),u.smile=L("\\smile ","&#8995;","smile"),u.sqsubseteq=L("\\sqsubseteq ","&#8849;","square subset or equal to"),u.sqsupseteq=L("\\sqsupseteq ","&#8850;","square superset or equal to"),u.doteq=L("\\doteq ","&#8784;","dotted equals"),u.frown=L("\\frown ","&#8994;","frown"),u.vdash=L("\\vdash ","&#8870;","v dash"),u.dashv=L("\\dashv ","&#8867;","dash v"),u.nless=L("\\nless ","&#8814;","not less than"),u.ngtr=L("\\ngtr ","&#8815;","not greater than"),u.longleftarrow=L("\\longleftarrow ","&#8592;","left arrow"),u.longrightarrow=L("\\longrightarrow ","&#8594;","right arrow"),u.Longleftarrow=L("\\Longleftarrow ","&#8656;","left arrow"),u.Longrightarrow=L("\\Longrightarrow ","&#8658;","right arrow"),u.longleftrightarrow=L("\\longleftrightarrow ","&#8596;","left and right arrow"),u.updownarrow=L("\\updownarrow ","&#8597;","up and down arrow"),u.Longleftrightarrow=L("\\Longleftrightarrow ","&#8660;","left and right arrow"),u.Updownarrow=L("\\Updownarrow ","&#8661;","up and down arrow"),u.mapsto=L("\\mapsto ","&#8614;","maps to"),u.nearrow=L("\\nearrow ","&#8599;","northeast arrow"),u.hookleftarrow=L("\\hookleftarrow ","&#8617;","hook left arrow"),u.hookrightarrow=L("\\hookrightarrow ","&#8618;","hook right arrow"),u.searrow=L("\\searrow ","&#8600;","southeast arrow"),u.leftharpoonup=L("\\leftharpoonup ","&#8636;","left harpoon up"),u.rightharpoonup=L("\\rightharpoonup ","&#8640;","right harpoon up"),u.swarrow=L("\\swarrow ","&#8601;","southwest arrow"),u.leftharpoondown=L("\\leftharpoondown ","&#8637;","left harpoon down"),u.rightharpoondown=L("\\rightharpoondown ","&#8641;","right harpoon down"),u.nwarrow=L("\\nwarrow ","&#8598;","northwest arrow"),u.ldots=L("\\ldots ","&#8230;","l dots"),u.cdots=L("\\cdots ","&#8943;","c dots"),u.vdots=L("\\vdots ","&#8942;","v dots"),u.ddots=L("\\ddots ","&#8945;","d dots"),u.surd=L("\\surd ","&#8730;","unresolved root"),u.triangle=L("\\triangle ","&#9651;","triangle"),u.ell=L("\\ell ","&#8467;","ell"),u.top=L("\\top ","&#8868;","top"),u.flat=L("\\flat ","&#9837;","flat"),u.natural=L("\\natural ","&#9838;","natural"),u.sharp=L("\\sharp ","&#9839;","sharp"),u.wp=L("\\wp ","&#8472;","wp"),u.bot=L("\\bot ","&#8869;","bot"),u.clubsuit=L("\\clubsuit ","&#9827;","club suit"),u.diamondsuit=L("\\diamondsuit ","&#9826;","diamond suit"),u.heartsuit=L("\\heartsuit ","&#9825;","heart suit"),u.spadesuit=L("\\spadesuit ","&#9824;","spade suit"),u.parallelogram=L("\\parallelogram ","&#9649;","parallelogram"),u.square=L("\\square ","&#11036;","square"),u.oint=L("\\oint ","&#8750;","o int"),u.bigcap=L("\\bigcap ","&#8745;","big cap"),u.bigcup=L("\\bigcup ","&#8746;","big cup"),u.bigsqcup=L("\\bigsqcup ","&#8852;","big square cup"),u.bigvee=L("\\bigvee ","&#8744;","big vee"),u.bigwedge=L("\\bigwedge ","&#8743;","big wedge"),u.bigodot=L("\\bigodot ","&#8857;","big o dot"),u.bigotimes=L("\\bigotimes ","&#8855;","big o times"),u.bigoplus=L("\\bigoplus ","&#8853;","big o plus"),u.biguplus=L("\\biguplus ","&#8846;","big u plus"),u.lfloor=L("\\lfloor ","&#8970;","left floor"),u.rfloor=L("\\rfloor ","&#8971;","right floor"),u.lceil=L("\\lceil ","&#8968;","left ceiling"),u.rceil=L("\\rceil ","&#8969;","right ceiling"),u.opencurlybrace=u.lbrace=L("\\lbrace ","{","left brace"),u.closecurlybrace=u.rbrace=L("\\rbrace ","}","right brace"),u.lbrack=L("[","left bracket"),u.rbrack=L("]","right bracket"),u.slash=L("/","slash"),u.vert=L("|","vertical bar"),u.perp=u.perpendicular=L("\\perp ","&perp;","perpendicular"),u.nabla=u.del=L("\\nabla ","&nabla;"),u.hbar=L("\\hbar ","&#8463;","horizontal bar"),u.AA=u.Angstrom=u.angstrom=L("\\text\\AA ","&#8491;","AA"),u.ring=u.circ=u.circle=L("\\circ ","&#8728;","circle"),u.bull=u.bullet=L("\\bullet ","&bull;","bullet"),u.setminus=u.smallsetminus=L("\\setminus ","&#8726;","set minus"),u.not=u["¬"]=u.neg=L("\\neg ","&not;","not"),u["…"]=u.dots=u.ellip=u.hellip=u.ellipsis=u.hellipsis=L("\\dots ","&hellip;","ellipsis"),u.converges=u.darr=u.dnarr=u.dnarrow=u.downarrow=L("\\downarrow ","&darr;","converges with"),u.dArr=u.dnArr=u.dnArrow=u.Downarrow=L("\\Downarrow ","&dArr;","down arrow"),u.diverges=u.uarr=u.uparrow=L("\\uparrow ","&uarr;","diverges from"),u.uArr=u.Uparrow=L("\\Uparrow ","&uArr;","up arrow"),u.rarr=u.rightarrow=L("\\rightarrow ","&rarr;","right arrow"),u.implies=T("\\Rightarrow ","&rArr;","implies"),u.rArr=u.Rightarrow=L("\\Rightarrow ","&rArr;","right arrow"),u.gets=T("\\gets ","&larr;","gets"),u.larr=u.leftarrow=L("\\leftarrow ","&larr;","left arrow"),u.impliedby=T("\\Leftarrow ","&lArr;","implied by"),u.lArr=u.Leftarrow=L("\\Leftarrow ","&lArr;","left arrow"),u.harr=u.lrarr=u.leftrightarrow=L("\\leftrightarrow ","&harr;","left and right arrow"),u.iff=T("\\Leftrightarrow ","&hArr;","if and only if"),u.hArr=u.lrArr=u.Leftrightarrow=L("\\Leftrightarrow ","&hArr;","left and right arrow"),u.Re=u.Real=u.real=L("\\Re ","&real;","real"),u.Im=u.imag=u.image=u.imagin=u.imaginary=u.Imaginary=L("\\Im ","&image;","imaginary"),u.part=u.partial=L("\\partial ","&part;","partial"),u.pounds=L("\\pounds ","&pound;"),u.alef=u.alefsym=u.aleph=u.alephsym=L("\\aleph ","&alefsym;","alef sym"),u.xist=u.xists=u.exist=u.exists=L("\\exists ","&exist;","there exists at least 1"),u.nexists=u.nexist=L("\\nexists ","&#8708;","there is no"),u.and=u.land=u.wedge=T("\\wedge ","&and;","and"),u.or=u.lor=u.vee=T("\\vee ","&or;","or"),u.o=u.O=u.empty=u.emptyset=u.oslash=u.Oslash=u.nothing=u.varnothing=T("\\varnothing ","&empty;","nothing"),u.cup=u.union=T("\\cup ","&cup;","union"),u.cap=u.intersect=u.intersection=T("\\cap ","&cap;","intersection"),u.deg=u.degree=L("\\degree ","&deg;","degrees"),u.ang=u.angle=L("\\angle ","&ang;","angle"),u.measuredangle=L("\\measuredangle ","&#8737;","measured angle"),__extends(D,Se=i),D.prototype.finalizeTree=function(t,e){this.sharedSiblingMethod(t,e)},D.prototype.siblingDeleted=function(t,e){this.sharedSiblingMethod(t,e)},D.prototype.siblingCreated=function(t,e){this.sharedSiblingMethod(t,e)},D.prototype.sharedSiblingMethod=function(t,e){e!==b&&this[1]instanceof D||this.fixDigitGrouping(t)},D.prototype.fixDigitGrouping=function(t){var e,n,r,i,o,s;if(t.enableDigitGrouping){n=e=this,r=0,i=[],o="\\ ",s=e;do{if(/^[0-9]$/.test(s.ctrlSeq))e=s;else if(s.ctrlSeq===o)e=s,r+=1;else{if("."!==s.ctrlSeq)break;e=s,i.push(s)}}while(s=e[b]);for(;s=n[1];)if(/^[0-9]$/.test(s.ctrlSeq))n=s;else if(s.ctrlSeq===o)n=s,r+=1;else{if("."!==s.ctrlSeq)break;n=s,i.push(s)}for(;n!==e&&e&&e.ctrlSeq===o;)e=e[1],--r;for(;n!==e&&n&&n.ctrlSeq===o;)n=n[b],--r;e===n&&e&&e.ctrlSeq===o||(0<r||1<i.length?this.removeGroupingBetween(e,n):i[0]?(i[0]!==e&&this.addGroupingBetween(i[0][b],e),i[0]!==n&&this.removeGroupingBetween(i[0][1],n)):this.addGroupingBetween(n,e))}},D.prototype.removeGroupingBetween=function(t,e){var n=t;do{if(n instanceof D&&n.setGroupingClass(void 0),!n||n===e)break}while(n=n[1])},D.prototype.addGroupingBetween=function(t,e){var n,r,i=t,o=0,s=0;for(i=t;i&&(s+=1,i!==e);)i=i[b];for(0===(n=s%3)&&(n=3),i=t;i&&(o+=1,r=void 0,4<=s&&(o===s?r="mq-group-leading-"+n:o%3==0&&o!==s&&(r="mq-group-start"),r=r||"mq-group-other"),i instanceof D&&i.setGroupingClass(r),i!==e);)i=i[b]},D.prototype.setGroupingClass=function(t){this._groupingClass!==t&&(this._groupingClass&&this.jQ.removeClass(this._groupingClass),t&&this.jQ.addClass(t),this._groupingClass=t)},__extends(Zn,Oe=pt=D),Zn.prototype.createLeftOf=function(t){var e=t[b],n=e&&e[b],r=t.parent.parent instanceof Ot?t.parent.parent.sub:void 0;t.options.autoSubscriptNumerals&&t.parent!==r&&(e instanceof ut&&!1!==e.isItalic||e instanceof Ot&&n instanceof ut&&!1!==n.isItalic)?((new Lt).createLeftOf(t),Oe.prototype.createLeftOf.call(this,t),t.insRightOf(t.parent.parent)):Oe.prototype.createLeftOf.call(this,t)},Zn.prototype.mathspeak=function(t){var e,n,r;return t&&t.createdLeftOf&&(n=(e=(t=t.createdLeftOf)[b])&&e[b],r=t.parent.parent instanceof Ot?t.parent.parent.sub:void 0,t.options.autoSubscriptNumerals)&&t.parent!==r&&(e instanceof ut&&!1!==e.isItalic||t[b]instanceof Ot&&n instanceof ut&&!1!==n.isItalic)?"Subscript "+Oe.prototype.mathspeak.call(this)+" Baseline":Oe.prototype.mathspeak.call(this)},ct=Zn,__extends(Yn,Le=i),Yn.prototype.text=function(){var t=this.ctrlSeq||"";return this.isPartOfOperator?"\\"==t[0]?t=t.slice(1,t.length):" "==t[t.length-1]&&(t=t.slice(0,-1)):(!this[b]||this[b]instanceof Yn||this[b]instanceof a||"\\ "===this[b].ctrlSeq||(t="*"+t),!this[1]||this[1]instanceof a||this[1]instanceof Ot||(t+="*")),t},Yn.prototype.mathspeak=function(){var t=this.ctrlSeq||"";return this.isPartOfOperator||1<t.length||this.parent&&this.parent.parent&&this.parent.parent.isTextBlock()?Le.prototype.mathspeak.call(this):'"'+t+'"'},ut=Yn,h.prototype.autoCommands={_maxLength:0},U.autoCommands=function(t){var e,n,r,i,o;if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(e=t.split(" "),n={},i=r=0;i<e.length;i+=1){if((o=e[i]).length<2)throw'autocommand "'+o+'" not minimum length of 2';if(u[o]===ht)throw'"'+o+'" is a built-in operator name';n[o]=1,r=wn(r,o.length)}return n._maxLength=r,n},h.prototype.quietEmptyDelimiters={},U.quietEmptyDelimiters=function(t){for(var e=t.split(" "),n={},r=0;r<e.length;r+=1)n[e[r]]=1;return n},h.prototype.autoParenthesizedFunctions={_maxLength:0},U.autoParenthesizedFunctions=function(t){var e,n,r,i,o;if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(e=t.split(" "),n={},i=r=0;i<e.length;i+=1){if((o=e[i]).length<2)throw'autocommand "'+o+'" not minimum length of 2';n[o]=1,r=wn(r,o.length)}return n._maxLength=r,n},__extends(Q,Te=ut),Q.prototype.checkAutoCmds=function(t){var e,n,r,i,o,s;if(!this.shouldIgnoreSubstitutionInSimpleSubscript(t.options)&&0<(n=(e=t.options.autoCommands)._maxLength||0)){for(r="",i=this,o=0;i instanceof Q&&i.ctrlSeq===i.letter&&o<n;)r=i.letter+r,i=i[b],o+=1;for(;r.length;){if(e.hasOwnProperty(r)){for(i=this,o=1;i&&o<r.length;o+=1,i=i[b]);return new y(i,this).remove(),t[b]=i[b],(On(s=u[r])?new s(r):s(r)).createLeftOf(t)}r=r.slice(1)}}},Q.prototype.autoParenthesize=function(t){var e,n,r,i,o,s,a=t.parent.ends[1];if(!(a&&a instanceof w&&"\\left("===a.ctrlSeq||this.shouldIgnoreSubstitutionInSimpleSubscript(t.options))){for(e="",n=this,r=0,o=(i=t.options.autoParenthesizedFunctions)._maxLength||0,s=t.options.autoOperatorNames;n instanceof Q&&r<o;)e=n.letter+e,n=n[b],r+=1;for(;e.length;){if(i.hasOwnProperty(e)&&s.hasOwnProperty(e))return t.parent.write(t,"(");e=e.slice(1)}}},Q.prototype.createLeftOf=function(t){Te.prototype.createLeftOf.call(this,t),this.checkAutoCmds(t),this.autoParenthesize(t)},Q.prototype.italicize=function(t){return this.isItalic=t,this.isPartOfOperator=!t,this.jQ.toggleClass("mq-operator-name",!t),this},Q.prototype.finalizeTree=function(t,e){this.sharedSiblingMethod(t,e)},Q.prototype.siblingDeleted=function(t,e){this.sharedSiblingMethod(t,e)},Q.prototype.siblingCreated=function(t,e){this.sharedSiblingMethod(t,e)},Q.prototype.sharedSiblingMethod=function(t,e){e!==b&&this[1]instanceof Q||this.autoUnItalicize(t)},Q.prototype.autoUnItalicize=function(t){var e,n,r,i,o,s,a,l,p,c,u,h,f,d,m=t.autoOperatorNames;if(0!==m._maxLength&&!this.shouldIgnoreSubstitutionInSimpleSubscript(t)){for(e=this.letter,n=this[b];n instanceof Q;n=n[b])e=n.letter+e;for(r=this[1];r instanceof Q;r=r[1])e+=r.letter;t=n&&n[1],i=r&&r[b],new y(t||this.parent.ends[b],i||this.parent.ends[1]).each(function(t){t instanceof Q&&(t.italicize(!0).jQ.removeClass("mq-first mq-last mq-followed-by-supsub"),t.ctrlSeq=t.letter)}),o=m._maxLength||0;t:for(s=0,a=n[1]||this.parent.ends[b];a&&s<e.length;s+=1,a=a[1])for(l=yn(o,e.length-s);0<l;--l)if(f=e.slice(s,s+l),p=void 0,m.hasOwnProperty(f)){for(c=0,u=a;c<l;c+=1,u=u[1])u instanceof Q&&(u.italicize(!1),p=u);h=rr.hasOwnProperty(f),a.ctrlSeq=(h?"\\":"\\operatorname{")+a.ctrlSeq,p.ctrlSeq+=h?" ":"}",or.hasOwnProperty(f)&&((f=(h=p[b])&&h[b])&&f[b]).jQ.addClass("mq-last"),this.shouldOmitPadding(a[b])||a.jQ.addClass("mq-first"),this.shouldOmitPadding(p[1])||(p[1]instanceof Ot?((d=p[1]).siblingCreated=d.siblingDeleted=function(){d.jQ.toggleClass("mq-after-operator-name",!(d[1]instanceof w))})():p.jQ.toggleClass("mq-last",!(p[1]instanceof w))),s+=l-1,a=p;continue t}}},Q.prototype.shouldOmitPadding=function(t){return!t||"."===t.ctrlSeq||t instanceof a||t instanceof Tt};for(var Jn,tr,er,nr=Q,rr={},ir=h.prototype.autoOperatorNames={_maxLength:9},or={limsup:1,liminf:1,projlim:1,injlim:1},sr="arg deg det dim exp gcd hom inf ker lg lim ln log max min sup limsup liminf injlim projlim Pr".split(" "),E=0;E<sr.length;E+=1)rr[sr[E]]=ir[sr[E]]=1;for(Jn="sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth".split(" "),E=0;E<Jn.length;E+=1)rr[Jn[E]]=1;for(tr="sin cos tan sec cosec csc cotan cot ctg".split(" "),E=0;E<tr.length;E+=1)ir[tr[E]]=ir["arc"+tr[E]]=ir[tr[E]+"h"]=ir["ar"+tr[E]+"h"]=ir["arc"+tr[E]+"h"]=1;for(er="gcf hcf lcm proj span".split(" "),E=0;E<er.length;E+=1)ir[er[E]]=1;function ar(t){return Ce.call(this,t||"")||this}for(ft in U.autoOperatorNames=function(t){var e,n,r,i,o,s;if("string"!=typeof t)throw'"'+t+'" not a space-delimited list';if(!/^[a-z\|\-]+(?: [a-z\|\-]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of letters or "|"';for(e=t.split(" "),n={},i=r=0;i<e.length;i+=1){if((o=e[i]).length<2)throw'"'+o+'" not minimum length of 2';if(o.indexOf("|")<0)r=wn(r,(n[o]=o).length);else{if(2<(s=o.split("|")).length)throw'"'+o+'" has more than 1 mathspeak delimiter';if(s[0].length<2)throw'"'+o[0]+'" not minimum length of 2';n[s[0]]=s[1].replace(/-/g," "),r=wn(r,s[0].length)}}return n._maxLength=r,n},__extends(ar,Ce=i),ar.prototype.createLeftOf=function(t){for(var e=this.ctrlSeq,n=0;n<e.length;n+=1)new nr(e.charAt(n)).createLeftOf(t)},ar.prototype.parser=function(){for(var t=this.ctrlSeq,e=new l,n=0;n<t.length;n+=1)new nr(t.charAt(n)).adopt(e,e.ends[1],0);return c.succeed(e.children())},ht=ar,ir)ir.hasOwnProperty(ft)&&(u[ft]=ht);function lr(){return null!==Ae&&Ae.apply(this,arguments)||this}function pr(){var t=this;return(t=je.call(this,"f")||this).letter="f",t.htmlTemplate='<var class="mq-f">f</var>',t}function cr(t,e,n){return De.call(this,t,'<span class="mq-nonSymbola">'+(e||t)+"</span>")||this}function ur(){return Qe.call(this,"\\%","%","percent")||this}function hr(t){var e=Ee.call(this)||this;return e.latexStr=t,e}function fr(t){var e;return!!t&&((e=t[b])?!(e instanceof a||/^(\\ )|[,;:\(\[]$/.test(e.ctrlSeq)):!!(t.parent&&t.parent.parent&&t.parent.parent.isStyleBlock())&&fr(t.parent.parent))}function dr(t,e,n){return Be.call(this,t,e,void 0,n,!0)||this}function mr(){return Ie.call(this,"+","+")||this}function gr(){return Me.call(this,"-","&minus;")||this}function yr(){return Re.call(this,"\\to ","&rarr;","to")||this}function wr(t,e){var n=this,r=e?"Strict":"";return(n=ze.call(this,t["ctrlSeq".concat(r)],t["html".concat(r)],t["text".concat(r)],t["mathspeak".concat(r)])||this).data=t,n.strict=e,n}function br(){return Ne.call(this,vt,!0)||this}function vr(){return Fe.call(this,"=","=","=","equals")||this}function xr(){return Pe.call(this,"\\sim ","~","~","tilde")||this}function qr(){return $e.call(this,"\\approx ","&approx;","≈","approximately equal")||this}function kr(t,e,n,r,i){n=Ge.call(this,t,"<"+e+" "+n+">&0</"+e+">")||this;return n.ariaLabel=r||t.replace(/^\\/,""),n.mathspeakTemplate=["Start"+n.ariaLabel+",","End"+n.ariaLabel],n.shouldNotSpeakDelimiters=i&&i.shouldNotSpeakDelimiters,n}function _r(){return He.call(this,"\\mathrm","span",'class="mq-roman mq-font"',"Roman Font",{shouldNotSpeakDelimiters:!0})||this}function Sr(){return null!==Ue&&Ue.apply(this,arguments)||this}function Or(){return null!==We&&We.apply(this,arguments)||this}function Lr(t){var e,n;if(!t)return"";if(!(t=t.children())||!t.ends[b])return"";for(e="",n=t.ends[b];n&&void 0!==n[1];n=n[1])void 0!==n.ctrlSeq&&(e+=n.ctrlSeq);return e}function Tr(){var t=null!==Ve&&Ve.apply(this,arguments)||this;return t.ctrlSeq="_{...}^{...}",t}function Cr(t){var e=this.parent,n=t;do{if(n[1])return t.insLeftOf(e)}while((n=n.parent.parent)!==e);t.insRightOf(e)}function Ar(){var t=null!==Ke&&Ke.apply(this,arguments)||this;return t.supsub="sub",t.htmlTemplate='<span class="mq-supsub mq-non-leaf"><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["_"],t.mathspeakTemplate=["Subscript,",", Baseline"],t.ariaLabel="subscript",t}function jr(){var t=null!==Ze&&Ze.apply(this,arguments)||this;return t.supsub="sup",t.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">&0</span></span>',t.textTemplate=["^(",")"],t.ariaLabel="superscript",t.mathspeakTemplate=["Superscript,",", Baseline"],t}function Dr(t,e,n){var r=Ye.call(this)||this;return r.ariaLabel=n||t.replace(/^\\/,""),i.prototype.setCtrlSeqHtmlTextAndMathspeak.call(r,t,'<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>'+e+'</big><span class="mq-from"><span>&0</span></span></span>'),r}function Qr(){var t=this;return(t=Xe.call(this,"\\int ","","integral")||this).ariaLabel="integral",t.htmlTemplate='<span class="mq-int mq-non-leaf"><big>&int;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>',t}function Er(){var t=null!==Je&&Je.apply(this,arguments)||this;return t.ctrlSeq="\\frac",t.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["(",")/(",")"],t}function Br(){return null!==tn&&tn.apply(this,arguments)||this}function Ir(){var t=null!==en&&en.apply(this,arguments)||this;return t.ctrlSeq="\\sqrt",t.htmlTemplate='<span class="mq-non-leaf mq-sqrt-container"><span class="mq-scaled mq-sqrt-prefix">'+_t.sqrt.html+'</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>',t.textTemplate=["sqrt(",")"],t.mathspeakTemplate=["StartRoot,",", EndRoot"],t.ariaLabel="root",t}function Mr(){var t=null!==nn&&nn.apply(this,arguments)||this;return t.ctrlSeq="\\hat",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-hat-prefix">^</span><span class="mq-hat-stem">&0</span></span>',t.textTemplate=["hat(",")"],t}function Rr(){var t=null!==rn&&rn.apply(this,arguments)||this;return t.htmlTemplate='<span class="mq-nthroot-container mq-non-leaf"><sup class="mq-nthroot mq-non-leaf">&0</sup><span class="mq-scaled mq-sqrt-container"><span class="mq-sqrt-prefix mq-scaled">'+_t.sqrt.html+'</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span></span>',t.textTemplate=["sqrt[","](",")"],t}function zr(){return null!==on&&on.apply(this,arguments)||this}function Nr(t,e,n){return sn.call(this,t,'<span class="mq-non-leaf"><span class="mq-diacritic-above">'+e+'</span><span class="mq-diacritic-stem">&0</span></span>',n)||this}function Fr(){return null!==an&&an.apply(this,arguments)||this}function B(t,e,n,r,i){var o=ln.call(this,"\\left"+r,void 0,[e,n])||this;return o.side=t,o.sides=((t={})[b]={ch:e,ctrlSeq:r},t[1]={ch:n,ctrlSeq:i},t),o}function Pr(t,e,n){var r,i;e=e||t,r=Et[t],i=Et[e],o[t]=function(){return new w(b,t,r,e,i)},o[r]=function(){return new w(1,t,r,e,i)},Bt[t]=Bt[r]=n}function $r(){return null!==pn&&pn.apply(this,arguments)||this}function Gr(){return null!==cn&&cn.apply(this,arguments)||this}function Hr(){var t=null!==un&&un.apply(this,arguments)||this;return t.ctrlSeq="\\binom",t.htmlTemplate='<span class="mq-non-leaf mq-bracket-container"><span style="width:'+It.width+'" class="mq-paren mq-bracket-l mq-scaled">'+It.html+'</span><span style="margin-left:'+It.width+"; margin-right:"+Mt.width+';" class="mq-non-leaf mq-bracket-middle"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span style="width:'+Mt.width+'" class="mq-paren mq-bracket-r mq-scaled">'+Mt.html+"</span></span>",t.textTemplate=["choose(",",",")"],t.mathspeakTemplate=["StartBinomial,","Choose",", EndBinomial"],t.ariaLabel="binomial",t}function Ur(){return null!==hn&&hn.apply(this,arguments)||this}function Wr(){var t=null!==fn&&fn.apply(this,arguments)||this;return t.ctrlSeq="\\MathQuillMathField",t.htmlTemplate='<span class="mq-editable-field"><span class="mq-root-block">&0</span></span>',t}function Vr(){return null!==dn&&dn.apply(this,arguments)||this}function Kr(){var t=null!==mn&&mn.apply(this,arguments)||this;return t.ctrlSeq="\\",t.htmlTemplate='<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>',t.textTemplate=["\\"],t}for(Ft in u.operatorname=(__extends(lr,Ae=n),lr.prototype.createLeftOf=function(){},lr.prototype.numBlocks=function(){return 1},lr.prototype.parser=function(){return f.block.map(function(t){var e=!0,n="",t=t.children();return t.each(function(t){t instanceof nr?n+=t.letter:e=!1}),e&&"ans"===n?At():t})},lr),u.f=(__extends(pr,je=nr),pr.prototype.italicize=function(t){return this.jQ.html("f").toggleClass("mq-f",t),je.prototype.italicize.call(this,t)},pr),u[" "]=u.space=function(){return new pt("\\ ","<span>&nbsp;</span>"," ")},u["."]=function(){return new pt(".",'<span class="mq-digit">.</span>',".")},u["'"]=u.prime=L("'","&prime;","prime"),u["″"]=u.dprime=L("″","&Prime;","double prime"),u.backslash=L("\\backslash ","\\","backslash"),o["\\"]||(o["\\"]=u.backslash),u.$=L("\\$","$","dollar"),u.square=L("\\square ","□","square"),u.mid=L("\\mid ","∣","mid"),__extends(cr,De=i),dt=cr,u["@"]=function(){return new dt("@")},u["&"]=function(){return new dt("\\&","&amp;","and")},u["%"]=(__extends(ur,Qe=dt),ur.prototype.parser=function(){var t=c.optWhitespace,e=c.string;return t.then(e("\\operatorname{of}").map(function(){return jt()})).or(Qe.prototype.parser.call(this))},ur),u["∥"]=u.parallel=L("\\parallel ","&#x2225;","parallel"),u["∦"]=u.nparallel=L("\\nparallel ","&#x2226;","not parallel"),u["⟂"]=u.perp=L("\\perp ","&#x27C2;","perpendicular"),u.alpha=u.beta=u.gamma=u.delta=u.zeta=u.eta=u.theta=u.iota=u.kappa=u.mu=u.nu=u.xi=u.rho=u.sigma=u.tau=u.chi=u.psi=u.omega=function(t){return new ut("\\"+t+" ","&"+t+";")},u.phi=Xn("\\phi ","&#981;"),u.phiv=u.varphi=Xn("\\varphi ","&phi;"),u.epsilon=Xn("\\epsilon ","&#1013;"),u.epsiv=u.varepsilon=Xn("\\varepsilon ","&epsilon;"),u.piv=u.varpi=Xn("\\varpi ","&piv;"),u.sigmaf=u.sigmav=u.varsigma=Xn("\\varsigma ","&sigmaf;"),u.thetav=u.vartheta=u.thetasym=Xn("\\vartheta ","&thetasym;"),u.upsilon=u.upsi=Xn("\\upsilon ","&upsilon;"),u.gammad=u.Gammad=u.digamma=Xn("\\digamma ","&#989;"),u.kappav=u.varkappa=Xn("\\varkappa ","&#1008;"),u.rhov=u.varrho=Xn("\\varrho ","&#1009;"),u.pi=u["π"]=function(){return new dt("\\pi ","&pi;","pi")},u.lambda=function(){return new dt("\\lambda ","&lambda;","lambda")},u.Upsilon=u.Upsi=u.upsih=u.Upsih=function(){return new i("\\Upsilon ",'<var style="font-family: serif">&upsih;</var>',"capital upsilon")},u.Gamma=u.Delta=u.Theta=u.Lambda=u.Xi=u.Pi=u.Sigma=u.Phi=u.Psi=u.Omega=u.forall=function(t){return new rt("\\"+t+" ","&"+t+";")},__extends(hr,Ee=n),hr.prototype.createLeftOf=function(t){var e,n=f.parse(this.latexStr);n.children().adopt(t.parent,t[b],t[1]),t[b]=n.ends[1],n.jQize().insertBefore(t.jQ),n.finalizeInsert(t.options,t),(e=(e=n.ends[1])&&e[1])&&e.siblingCreated(t.options,b),(n=(e=n.ends[b])&&e[b])&&n.siblingCreated(t.options,1),t.parent.bubble(function(t){t.reflow()})},hr.prototype.mathspeak=function(){return f.parse(this.latexStr).mathspeak()},hr.prototype.parser=function(){var t=f.parse(this.latexStr).children();return c.succeed(t)},t=hr,u["⁰"]=function(){return new t("^0")},u["¹"]=function(){return new t("^1")},u["²"]=function(){return new t("^2")},u["³"]=function(){return new t("^3")},u["⁴"]=function(){return new t("^4")},u["⁵"]=function(){return new t("^5")},u["⁶"]=function(){return new t("^6")},u["⁷"]=function(){return new t("^7")},u["⁸"]=function(){return new t("^8")},u["⁹"]=function(){return new t("^9")},u["¼"]=function(){return new t("\\frac14")},u["½"]=function(){return new t("\\frac12")},u["¾"]=function(){return new t("\\frac34")},u["√"]=function(){return new t("\\sqrt{}")},__extends(dr,Be=a),dr.prototype.contactWeld=function(t,e){this.sharedSiblingMethod(t.options,e)},dr.prototype.siblingCreated=function(t,e){this.sharedSiblingMethod(t,e)},dr.prototype.siblingDeleted=function(t,e){this.sharedSiblingMethod(t,e)},dr.prototype.sharedSiblingMethod=function(t,e){if(1!==e)return this.jQ[0].className=fr(this)?"mq-binary-operator":"",this},mt=dr,u["+"]=(__extends(mr,Ie=mt),mr.prototype.mathspeak=function(){return fr(this)?"plus":"positive"},mr),__extends(gr,Me=mt),gr.prototype.mathspeak=function(){return fr(this)?"minus":"negative"},gt=gr,u["−"]=u["—"]=u["–"]=u["-"]=gt,u["±"]=u.pm=u.plusmn=u.plusminus=function(){return new mt("\\pm ","&plusmn;","plus-or-minus")},u.mp=u.mnplus=u.minusplus=function(){return new mt("\\mp ","&#8723;","minus-or-plus")},o["*"]=u.sdot=u.cdot=T("\\cdot ","&middot;","*","times"),__extends(yr,Re=a),yr.prototype.deleteTowards=function(t,e){var n;t===b?(n=e[b],new y(n,this).remove(),e[b]=n[b],(new gt).createLeftOf(e),e[b].bubble(function(t){t.reflow()})):Re.prototype.deleteTowards.call(this,t,e)},yt=yr,u["→"]=u.to=yt,__extends(wr,ze=a),wr.prototype.swap=function(t){t=(this.strict=t)?"Strict":"";this.ctrlSeq=this.data["ctrlSeq".concat(t)],this.jQ.html(this.data["html".concat(t)]),this.textTemplate=[this.data["text".concat(t)]],this.mathspeakName=this.data["mathspeak".concat(t)]},wr.prototype.deleteTowards=function(t,e){t!==b||this.strict?ze.prototype.deleteTowards.call(this,t,e):(this.swap(!0),this.bubble(function(t){t.reflow()}))},bt={ctrlSeq:"\\le ",html:"&le;",text:"≤",mathspeak:"less than or equal to",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<",mathspeakStrict:"less than"},vt={ctrlSeq:"\\ge ",html:"&ge;",text:"≥",mathspeak:"greater than or equal to",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">",mathspeakStrict:"greater than"},__extends(br,Ne=wt=wr),br.prototype.createLeftOf=function(t){var e=t[b];e instanceof a&&"-"===e.ctrlSeq?(t[b]=(e=e)[b],e.remove(),(new yt).createLeftOf(t),t[b].bubble(function(t){t.reflow()})):Ne.prototype.createLeftOf.call(this,t)},Jt=br,u["<"]=u.lt=function(){return new wt(bt,!0)},u[">"]=u.gt=Jt,u["≤"]=u.le=u.leq=function(){return new wt(bt,!1)},u["≥"]=u.ge=u.geq=function(){return new wt(vt,!1)},u.infty=u.infin=u.infinity=L("\\infty ","&infin;","infinity"),u["≠"]=u.ne=u.neq=T("\\ne ","&ne;","not equal"),__extends(vr,Fe=a),vr.prototype.createLeftOf=function(t){var e=t[b];e instanceof wt&&e.strict?(e.swap(!1),e.bubble(function(t){t.reflow()})):Fe.prototype.createLeftOf.call(this,t)},xt=vr,u["="]=xt,u["×"]=u.times=T("\\times ","&times;","[x]","times"),u["÷"]=u.div=u.divide=u.divides=T("\\div ","&divide;","[/]","over"),__extends(xr,Pe=a),xr.prototype.createLeftOf=function(t){var e;t[b]instanceof xr?(e=t[b],t[b]=e[b],e.remove(),(new kt).createLeftOf(t),t[b].bubble(function(t){t.reflow()})):Pe.prototype.createLeftOf.call(this,t)},qt=xr,__extends(qr,$e=a),qr.prototype.deleteTowards=function(t,e){var n;t===b?(n=e[b],new y(n,this).remove(),e[b]=n[b],(new qt).createLeftOf(e),e[b].bubble(function(t){t.reflow()})):$e.prototype.deleteTowards.call(this,t,e)},kt=qr,o["~"]=u.sim=qt,u["≈"]=u.approx=kt,_t={sqrt:{width:"",html:'<svg preserveAspectRatio="none" viewBox="0 0 32 54"><path d="M0 33 L7 27 L12.5 47 L13 47 L30 0 L32 0 L13 54 L11 54 L4.5 31 L0 33" /></svg>'},"|":{width:".4em",html:'<svg preserveAspectRatio="none" viewBox="0 0 10 54"><path d="M4.4 0 L4.4 54 L5.6 54 L5.6 0" /></svg>'},"[":{width:".55em",html:'<svg preserveAspectRatio="none" viewBox="0 0 11 24"><path d="M8 0 L3 0 L3 24 L8 24 L8 23 L4 23 L4 1 L8 1" /></svg>'},"]":{width:".55em",html:'<svg preserveAspectRatio="none" viewBox="0 0 11 24"><path d="M3 0 L8 0 L8 24 L3 24 L3 23 L7 23 L7 1 L3 1" /></svg>'},"(":{width:".55em",html:'<svg preserveAspectRatio="none" viewBox="3 0 106 186"><path d="M85 0 A61 101 0 0 0 85 186 L75 186 A75 101 0 0 1 75 0" /></svg>'},")":{width:".55em",html:'<svg preserveAspectRatio="none" viewBox="3 0 106 186"><path d="M24 0 A61 101 0 0 1 24 186 L34 186 A75 101 0 0 0 34 0" /></svg>'},"{":{width:".7em",html:'<svg preserveAspectRatio="none" viewBox="10 0 210 350"><path d="M170 0 L170 6 A47 52 0 0 0 123 60 L123 127 A35 48 0 0 1 88 175 A35 48 0 0 1 123 223 L123 290 A47 52 0 0 0 170 344 L170 350 L160 350 A58 49 0 0 1 102 301 L103 220 A45 40 0 0 0 58 180 L58 170 A45 40 0 0 0 103 130 L103 49 A58 49 0 0 1 161 0" /></svg>'},"}":{width:".7em",html:'<svg preserveAspectRatio="none" viewBox="10 0 210 350"><path d="M60 0 L60 6 A47 52 0 0 1 107 60 L107 127 A35 48 0 0 0 142 175 A35 48 0 0 0 107 223 L107 290 A47 52 0 0 1 60 344 L60 350 L70 350 A58 49 0 0 0 128 301 L127 220 A45 40 0 0 1 172 180 L172 170 A45 40 0 0 1 127 130 L127 49 A58 49 0 0 0 70 0" /></svg>'},"&#8741;":{width:".7em",html:'<svg preserveAspectRatio="none" viewBox="0 0 10 54"><path d="M3.2 0 L3.2 54 L4 54 L4 0 M6.8 0 L6.8 54 L6 54 L6 0" /></svg>'},"&lang;":{width:".55em",html:'<svg preserveAspectRatio="none" viewBox="0 0 10 54"><path d="M6.8 0 L3.2 27 L6.8 54 L7.8 54 L4.2 27 L7.8 0" /></svg>'},"&rang;":{width:".55em",html:'<svg preserveAspectRatio="none" viewBox="0 0 10 54"><path d="M3.2 0 L6.8 27 L3.2 54 L2.2 54 L5.8 27 L2.2 0" /></svg>'}},__extends(kr,Ge=n),kr.prototype.mathspeak=function(n){return!this.shouldNotSpeakDelimiters||n&&n.ignoreShorthand?Ge.prototype.mathspeak.call(this):this.foldChildren("",function(t,e){return t+" "+e.mathspeak(n)}).trim()},e=kr,u.mathrm=(__extends(_r,He=e),_r.prototype.isTextBlock=function(){return!0},_r),u.mathit=function(){return new e("\\mathit","i",'class="mq-font"',"Italic Font")},u.mathbf=function(){return new e("\\mathbf","b",'class="mq-font"',"Bold Font")},u.mathsf=function(){return new e("\\mathsf","span",'class="mq-sans-serif mq-font"',"Serif Font")},u.mathtt=function(){return new e("\\mathtt","span",'class="mq-monospace mq-font"',"Math Text")},u.underline=function(){return new e("\\underline","span",'class="mq-non-leaf mq-underline"',"Underline")},u.overline=u.bar=function(){return new e("\\overline","span",'class="mq-non-leaf mq-overline"',"Overline")},u.overrightarrow=function(){return new e("\\overrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-right"',"Over Right Arrow")},u.overleftarrow=function(){return new e("\\overleftarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-left"',"Over Left Arrow")},u.overleftrightarrow=function(){return new e("\\overleftrightarrow ","span",'class="mq-non-leaf mq-overarrow mq-arrow-leftright"',"Over Left and Right Arrow")},u.overarc=function(){return new e("\\overarc","span",'class="mq-non-leaf mq-overarc"',"Over Arc")},u.dot=function(){return new n("\\dot",'<span class="mq-non-leaf"><span class="mq-dot-recurring-inner"><span class="mq-dot-recurring">&#x2d9;</span><span class="mq-empty-box">&0</span></span></span>')},u.textcolor=(__extends(Sr,Ue=n),Sr.prototype.setColor=function(t){this.color=t,this.htmlTemplate='<span class="mq-textcolor" style="color:'+t+'">&0</span>',this.ariaLabel=t.replace(/^\\/,""),this.mathspeakTemplate=["Start "+this.ariaLabel+",","End "+this.ariaLabel]},Sr.prototype.latex=function(){var t=this.blocks[0];return"\\textcolor{"+this.color+"}{"+t.latex()+"}"},Sr.prototype.parser=function(){var e=this,t=c.optWhitespace,n=c.string,r=c.regex;return t.then(n("{")).then(r(/^[#\w\s.,()%-]*/)).skip(n("}")).then(function(t){return e.setColor(t),Ue.prototype.parser.call(e)})},Sr.prototype.isStyleBlock=function(){return!0},Sr),u.class=(__extends(Or,We=n),Or.prototype.parser=function(){var e=this,t=c.string,n=c.regex;return c.optWhitespace.then(t("{")).then(n(/^[-\w\s\\\xA0-\xFF]*/)).skip(t("}")).then(function(t){return e.cls=t||"",e.htmlTemplate='<span class="mq-class '+t+'">&0</span>',e.ariaLabel=t+" class",e.mathspeakTemplate=["Start "+e.ariaLabel+",","End "+e.ariaLabel],We.prototype.parser.call(e)})},Or.prototype.latex=function(){var t=this.blocks[0];return"\\class{"+this.cls+"}{"+t.latex()+"}"},Or.prototype.isStyleBlock=function(){return!0},Or),St=/^[\+\-]?[\d]+$/,h.prototype.charsThatBreakOutOfSupSub="",__extends(Tr,Ve=n),Tr.prototype.createLeftOf=function(t){if(this.replacedFragment||t[b]||!t.options.supSubsRequireOperand)return Ve.prototype.createLeftOf.call(this,t)},Tr.prototype.contactWeld=function(t){for(var e,n,r,i,o,s,a=b;a;a=a===b&&1)if(n=void 0,(e=this[a])instanceof Tr){for(r="sub";r;r="sub"===r&&"sup")i=this[r],o=e[r],i&&(o?i.isEmpty()?n=new M(o,0,o.ends[b]):(i.jQ.children().insAtDirEnd(-a,o.jQ),s=i.children().disown(),n=new M(o,s.ends[1],o.ends[b]),a===b?s.adopt(o,o.ends[1],0):s.adopt(o,0,o.ends[b])):e.addBlock(i.disown()),this.placeCursor=function(e,n){return function(t){t.insAtDirEnd(-a,e||n)}}(o,i));this.remove(),t&&t[b]===this&&(1===a&&n?n[b]?t.insRightOf(n[b]):t.insAtLeftEnd(n.parent):t.insRightOf(e));break}},Tr.prototype.finalizeTree=function(){this.ends[b].write=function(t,e){var n;if(t.options.autoSubscriptNumerals&&this===this.parent.sub)return"_"===e?void 0:((n=this.chToCmd(e,t.options))instanceof i?t.deleteSelection():t.clearSelection().insRightOf(this.parent),n.createLeftOf(t.show()),void t.controller.aria.queue("Baseline").alert(n.mathspeak({createdLeftOf:t})));t[b]&&!t[1]&&!t.selection&&-1<t.options.charsThatBreakOutOfSupSub.indexOf(e)&&(t.insRightOf(this.parent),t.controller.aria.queue("Baseline")),l.prototype.write.call(this,t,e)}},Tr.prototype.moveTowards=function(t,e,n){e.options.autoSubscriptNumerals&&!this.sup?e.insDirOf(t,this):Ve.prototype.moveTowards.call(this,t,e,n)},Tr.prototype.deleteTowards=function(t,e){var n;e.options.autoSubscriptNumerals&&this.sub?((n=this.sub.ends[-t])instanceof i?n.remove():n&&n.deleteTowards(t,e.insAtDirEnd(-t,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(b,e.insAtLeftEnd(this.sub)),this.sup)&&e.insDirOf(-t,this)):Ve.prototype.deleteTowards.call(this,t,e)},Tr.prototype.latex=function(){function t(t,e){var n=e&&e.latex();return e?t+"{"+(n||" ")+"}":""}return t("_",this.sub)+t("^",this.sup)},Tr.prototype.text=function(){function t(t,e){var n=e&&e.text()||"";return e?t+(1===n.length?n:"("+(n||" ")+")"):""}return t("_",this.sub)+t("^",this.sup)},Tr.prototype.addBlock=function(t){"sub"===this.supsub?((this.sup=this.upInto=this.sub.upOutOf=t).adopt(this,this.sub,0).downOutOf=this.sub,t.jQ=g('<span class="mq-sup"/>').append(t.jQ.children()).prependTo(this.jQ),z.linkElementByBlockNode(t.jQ[0],t)):((this.sub=this.downInto=this.sup.downOutOf=t).adopt(this,0,this.sup).upOutOf=this.sup,t.jQ=g('<span class="mq-sub"></span>').append(t.jQ.children()).appendTo(this.jQ.removeClass("mq-sup-only")),z.linkElementByBlockNode(t.jQ[0],t),this.jQ.append('<span style="display:inline-block;width:0">&#8203;</span>'));for(var e=0;e<2;e+=1)!function(r,i,o,s){r[i].deleteOutOf=function(t,e){var n;e.insDirOf(this[t]?-t:t,this.parent),this.isEmpty()||(n=this.ends[t],this.children().disown().withDirAdopt(t,e.parent,e[t],e[-t]).jQ.insDirOf(-t,e.jQ),e[-t]=n),r.supsub=o,delete r[i],delete r["".concat(s,"Into")],(e=r[o])["".concat(s,"OutOf")]=Cr,delete e.deleteOutOf,"sub"===i&&g(r.jQ.addClass("mq-sup-only")[0].lastChild).remove(),this.remove()}}(this,"sub sup".split(" ")[e],"sup sub".split(" ")[e],"down up".split(" ")[e])},__extends(Ar,Ke=Ot=Tr),Ar.prototype.finalizeTree=function(){this.downInto=this.sub=this.ends[b],this.sub.upOutOf=Cr,Ke.prototype.finalizeTree.call(this)},Lt=Ar,u.subscript=u._=Lt,u.superscript=u.supscript=u["^"]=(__extends(jr,Ze=Ot),jr.prototype.mathspeak=function(t){var e,n=this.upInto;return void 0===n||(e=Lr(n),t&&t.ignoreShorthand)||!St.test(e)?Ze.prototype.mathspeak.call(this):"0"===e?"to the 0 power":"2"===e?"squared":"3"===e?"cubed":(t="",/^[+-]?\d{1,3}$/.test(e)&&(/(11|12|13|4|5|6|7|8|9|0)$/.test(e)?t="th":/1$/.test(e)?t="st":/2$/.test(e)?t="nd":/3$/.test(e)&&(t="rd")),"to the "+("object"==typeof n?n.mathspeak():e)+t+" power")},jr.prototype.finalizeTree=function(){this.upInto=this.sup=this.ends[1],this.sup.downOutOf=Cr,Ze.prototype.finalizeTree.call(this)},jr),__extends(Dr,Ye=n),Dr.prototype.createLeftOf=function(t){Ye.prototype.createLeftOf.call(this,t),t.options.sumStartsWithNEquals&&(new nr("n").createLeftOf(t),(new xt).createLeftOf(t))},Dr.prototype.latex=function(){function t(t){return"{"+(t||" ")+"}"}return this.ctrlSeq+"_"+t(this.ends[b].latex())+"^"+t(this.ends[1].latex())},Dr.prototype.mathspeak=function(){return"Start "+this.ariaLabel+" from "+this.ends[b].mathspeak()+" to "+this.ends[1].mathspeak()+", end "+this.ariaLabel+", "},Dr.prototype.parser=function(){for(var t=c.string,e=c.optWhitespace,n=c.succeed,r=f.block,i=this,o=i.blocks=[new l,new l],s=0;s<o.length;s+=1)o[s].adopt(i,i.ends[1],0);return e.then(t("_").or(t("^"))).then(function(t){var e=o["_"===t?0:1];return r.then(function(t){return t.children().adopt(e,e.ends[1],0),n(i)})}).many().result(i)},Dr.prototype.finalizeTree=function(){var t=this.ends[b],e=this.ends[1];t.ariaLabel="lower bound",e.ariaLabel="upper bound",this.downInto=t,this.upInto=e,(t.upOutOf=e).downOutOf=t},Tt=Dr,u["∑"]=u.sum=u.summation=function(){return new Tt("\\sum ","&sum;","sum")},u["∏"]=u.prod=u.product=function(){return new Tt("\\prod ","&prod;","product")},u.coprod=u.coproduct=function(){return new Tt("\\coprod ","&#8720;","co product")},u["∫"]=u.int=u.integral=(__extends(Qr,Xe=Tt),Qr.prototype.createLeftOf=function(t){n.prototype.createLeftOf.call(this,t)},Qr),oe=u.frac=u.dfrac=u.cfrac=u.fraction=(__extends(Er,Je=n),Er.prototype.finalizeTree=function(){var t=this.ends[b],e=this.ends[1];this.upInto=e.upOutOf=t,this.downInto=t.downOutOf=e,t.ariaLabel="numerator",e.ariaLabel="denominator",1<this.getFracDepth()?this.mathspeakTemplate=["StartNestedFraction,","NestedOver",", EndNestedFraction"]:this.mathspeakTemplate=["StartFraction,","Over",", EndFraction"]},Er.prototype.mathspeak=function(t){var e,n,r,i,o;if(t&&t.createdLeftOf)return t.createdLeftOf.parent.mathspeak();if(r=Lr(this.ends[b]),e=Lr(this.ends[1]),t&&t.ignoreShorthand||!St.test(r)||!St.test(e)||(t="1"===r||"-1"===r,n="","2"===e?n=t?"half":"halves":"3"===e?n=t?"third":"thirds":"4"===e?n=t?"quarter":"quarters":"5"===e?n=t?"fifth":"fifths":"6"===e?n=t?"sixth":"sixths":"7"===e?n=t?"seventh":"sevenths":"8"===e?n=t?"eighth":"eighths":"9"===e&&(n=t?"ninth":"ninths"),""===n))return Je.prototype.mathspeak.call(this);for(r="",i=!1,o=this[b];o&&void 0!==o[b];o=o[b])if("\\ "!==o.ctrlSeq){if(!St.test(o.ctrlSeq||"")){i=!1;break}i=!0}return i&&(r+="and "),r+=this.ends[b].mathspeak()+" "+n},Er.prototype.getFracDepth=function(){var n=function(t,e){return t instanceof s&&t.ctrlSeq&&0<=t.ctrlSeq.toLowerCase().search("frac")&&(e+=1),t&&t.parent?n(t.parent,e):e};return n(this,0)},Er),Ct=u.over=o["/"]=(__extends(Br,tn=oe),Br.prototype.createLeftOf=function(t){var e,n,r;if(!this.replacedFragment){if(e=t[b],!t.options.typingSlashCreatesNewFraction)for(;e&&!(e instanceof a||e instanceof(u.text||bn)||e instanceof Tt||"\\ "===e.ctrlSeq||/^[,;:]$/.test(e.ctrlSeq));)e=e[b];(e=e instanceof Tt&&e[1]instanceof Ot&&(n=(e=e[1])[1])instanceof Ot&&n.ctrlSeq!=e.ctrlSeq?e[1]:e)===t[b]||t.isTooDeep(1)||(n=e[1],r=t[b],this.replaces(new y(n||t.parent.ends[b],r)),t[b]=e)}tn.prototype.createLeftOf.call(this,t)},Br),At=function(){return new i("\\operatorname{ans}",'<span class="mq-ans">ans</span>',"ans")},u.ans=At,jt=function(){return new i("\\%\\operatorname{of}",'<span class="mq-nonSymbola mq-operator-name">% of </span>',"percent of")},u.percent=u.percentof=jt,__extends(Ir,en=n),Ir.prototype.parser=function(){return f.optBlock.then(function(n){return f.block.map(function(t){var e=new Dt;return e.blocks=[n,t],n.adopt(e,0,0),t.adopt(e,n,0),e})}).or(en.prototype.parser.call(this))},u.sqrt=ae=Ir,u.hat=(__extends(Mr,nn=n),Mr),__extends(Rr,rn=ae),Rr.prototype.latex=function(){return"\\sqrt["+this.ends[b].latex()+"]{"+this.ends[1].latex()+"}"},Rr.prototype.mathspeak=function(){var t=this.ends[b].mathspeak(),e=this.ends[1].mathspeak();return this.ends[b].ariaLabel="Index",this.ends[1].ariaLabel="Radicand","3"===t?"Start Cube Root, "+e+", End Cube Root":"Root Index "+t+", Start Root, "+e+", End Root"},Dt=Rr,u.nthroot=Dt,u.cbrt=(__extends(zr,on=Dt),zr.prototype.createLeftOf=function(t){on.prototype.createLeftOf.call(this,t),new ct("3").createLeftOf(t),t.controller.moveRight()},zr),__extends(Nr,sn=n),Qt=Nr,u.vec=function(){return new Qt("\\vec","&rarr;",["vec(",")"])},u.tilde=function(){return new Qt("\\tilde","~",["tilde(",")"])},__extends(Fr,an=n),Fr.prototype.jQadd=function(t){return an.prototype.jQadd.call(this,t),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)"),this.jQ},__extends(B,ln=le=Fr),B.prototype.numBlocks=function(){return 1},B.prototype.html=function(){var t=this.getSymbol(b),e=this.getSymbol(1);return this.htmlTemplate='<span class="mq-non-leaf mq-bracket-container"><span style="width:'+t.width+'" class="mq-scaled mq-bracket-l mq-paren'+(1===this.side?" mq-ghost":"")+'">'+t.html+'</span><span style="margin-left:'+t.width+";margin-right:"+e.width+'" class="mq-bracket-middle mq-non-leaf">&0</span><span style="width:'+e.width+'" class="mq-scaled mq-bracket-r mq-paren'+(this.side===b?" mq-ghost":"")+'">'+e.html+"</span></span>",ln.prototype.html.call(this)},B.prototype.getSymbol=function(t){t=this.sides[t||1].ch;return _t[t]||{width:"0",html:""}},B.prototype.latex=function(){return"\\left"+this.sides[b].ctrlSeq+this.ends[b].latex()+"\\right"+this.sides[1].ctrlSeq},B.prototype.mathspeak=function(t){var e=this.sides[b].ch,n=this.sides[1].ch;if("|"===e&&"|"===n)this.mathspeakTemplate=["StartAbsoluteValue,",", EndAbsoluteValue"],this.ariaLabel="absolute value";else{if(t&&t.createdLeftOf&&this.side)return t="",this.side===b?t=this.textTemplate[0]:1===this.side&&(t=this.textTemplate[1]),(this.side===b?"left ":"right ")+Bt[t];this.mathspeakTemplate=["left "+Bt[e]+",",", right "+Bt[n]],this.ariaLabel=Bt[e]+" block"}return ln.prototype.mathspeak.call(this)},B.prototype.matchBrack=function(t,e,n){return n instanceof B&&n.side&&n.side!==-e&&(!t.restrictMismatchedBrackets||Et[this.sides[this.side].ch]===n.sides[n.side].ch||{"(":"]","[":")"}[this.sides[b].ch]===n.sides[1].ch)&&n},B.prototype.closeOpposing=function(t){t.side=0,t.sides[this.side]=this.sides[this.side];t=t.delimjQs.eq(this.side===b?0:1).removeClass("mq-ghost");this.replaceBracket(t,this.side)},B.prototype.createLeftOf=function(t){var e,n;this.replacedFragment||(e=t.options,e="|"===this.sides[b].ch?this.matchBrack(e,1,t[1])||this.matchBrack(e,b,t[b])||this.matchBrack(e,0,t.parent.parent):this.matchBrack(e,-this.side,t[-this.side])||this.matchBrack(e,-this.side,t.parent.parent)),e?(n=this.side=-e.side,this.closeOpposing(e),e===t.parent.parent&&t[n]&&new y(t[n],t.parent.ends[n],-n).disown().withDirAdopt(-n,e.parent,e,e[n]).jQ.insDirOf(n,e.jQ),e.bubble(function(t){t.reflow()})):(n=(e=this).side,e.replacedFragment?e.side=0:t[-n]&&(e.replaces(new y(t[-n],t.parent.ends[-n],n)),t[-n]=0),ln.prototype.createLeftOf.call(this,t)),n===b?t.insAtLeftEnd(e.ends[b]):t.insRightOf(e)},B.prototype.placeCursor=function(){},B.prototype.unwrap=function(){this.ends[b].children().disown().adopt(this.parent,this,this[1]).jQ.insertAfter(this.jQ),this.remove()},B.prototype.deleteSide=function(t,e,n){var r,i,o,s=this.parent,a=this[t],l=s.ends[t];if(t===this.side)this.unwrap(),a?n.insDirOf(-t,a):n.insAtDirEnd(t,s);else if(i=n.options,o=!this.side,this.side=-t,this.matchBrack(i,t,this.ends[b].ends[this.side]))this.closeOpposing(this.ends[b].ends[this.side]),r=this.ends[b].ends[t],this.unwrap(),r&&r.siblingCreated(n.options,t),a?n.insDirOf(-t,a):n.insAtDirEnd(t,s);else{if(this.matchBrack(i,t,this.parent.parent))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else{if(e&&o)return this.unwrap(),void(a?n.insDirOf(-t,a):n.insAtDirEnd(t,s));this.sides[t]=(o=(i=this).side,i=i.sides[o],{ch:Et[i.ch],ctrlSeq:Et[i.ctrlSeq]}),s=this.delimjQs.removeClass("mq-ghost").eq(t===b?0:1).addClass("mq-ghost"),this.replaceBracket(s,t)}a?(r=this.ends[b].ends[t],new y(a,l,-t).disown().withDirAdopt(-t,this.ends[b],r,0).jQ.insAtDirEnd(t,this.ends[b].jQ.removeClass("mq-empty")),r&&r.siblingCreated(n.options,t),n.insDirOf(-t,a)):e?n.insDirOf(t,this):n.insAtDirEnd(t,this.ends[b])}},B.prototype.replaceBracket=function(t,e){var n=this.getSymbol(e);t.html(n.html).css("width",n.width),e===b?t.next().css("margin-left",n.width):t.prev().css("margin-right",n.width)},B.prototype.deleteTowards=function(t,e){this.deleteSide(-t,!1,e)},B.prototype.finalizeTree=function(){this.ends[b].deleteOutOf=function(t,e){this.parent.deleteSide(t,!0,e)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===b?1:0).removeClass("mq-ghost"),this.side=0}},B.prototype.siblingCreated=function(t,e){e===-this.side&&this.finalizeTree()},w=B,Et={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|","\\lVert ":"\\rVert ","\\rVert ":"\\lVert "},Bt={"&lang;":"angle-bracket","&rang;":"angle-bracket","|":"pipe"},Pr("(","","parenthesis"),Pr("[","","bracket"),Pr("{","\\{","brace"),u.langle=function(){return new w(b,"&lang;","&rang;","\\langle ","\\rangle ")},u.rangle=function(){return new w(1,"&lang;","&rang;","\\langle ","\\rangle ")},o["|"]=function(){return new w(b,"|","|","|","|")},u.lVert=function(){return new w(b,"&#8741;","&#8741;","\\lVert ","\\rVert ")},u.rVert=function(){return new w(1,"&#8741;","&#8741;","\\lVert ","\\rVert ")},u.left=(__extends($r,pn=n),$r.prototype.parser=function(){var t=c.regex,e=c.string,o=c.optWhitespace;return o.then(t(/^(?:[([|]|\\\{|\\langle(?![a-zA-Z])|\\lVert(?![a-zA-Z]))/)).then(function(r){var i=r.replace(/^\\/,"");return"\\langle"==r&&(i="&lang;",r+=" "),"\\lVert"==r&&(i="&#8741;",r+=" "),f.then(function(n){return e("\\right").skip(o).then(t(/^(?:[\])|]|\\\}|\\rangle(?![a-zA-Z])|\\rVert(?![a-zA-Z]))/)).map(function(t){var e=t.replace(/^\\/,"");return"\\rangle"==t&&(e="&rang;",t+=" "),"\\rVert"==t&&(e="&#8741;",t+=" "),(e=new w(0,i,e,r,t)).blocks=[n],n.adopt(e,0,0),e})})})},$r),u.right=(__extends(Gr,cn=n),Gr.prototype.parser=function(){return c.fail("unmatched \\right")},Gr),It=_t["("],Mt=_t[")"],__extends(Hr,un=le),u.binom=u.binomial=Rt=Hr,u.choose=(__extends(Ur,hn=Rt),Ur.prototype.createLeftOf=function(t){Ct.prototype.createLeftOf(t)},Ur),__extends(Wr,fn=n),Wr.prototype.parser=function(){var e=this,t=c.string,n=c.regex,r=c.succeed;return t("[").then(n(/^[a-z][a-z0-9]*/i)).skip(t("]")).map(function(t){e.name=t}).or(r(void 0)).then(fn.prototype.parser.call(this))},Wr.prototype.finalizeTree=function(t){t=new nt(this.ends[b],this.jQ,t);t.KIND_OF_MQ="MathField",t.editable=!0,t.createTextarea(),t.editablesTextareaEvents(),t.cursor.insAtRightEnd(t.root),jn(t.root)},Wr.prototype.registerInnerField=function(t,e){e=new e(this.ends[b].controller);t[this.name]=e,t.push(e)},Wr.prototype.latex=function(){return this.ends[b].latex()},Wr.prototype.text=function(){return this.ends[b].text()},u.editable=u.MathQuillMathField=Wr,__extends(Vr,dn=i),Vr.prototype.setOptions=function(t){function e(){return""}return this.text=t.text||e,this.htmlTemplate=t.htmlString||"",this.latex=t.latex||e,this},Vr.prototype.parser=function(){var n=this,t=c.string,r=c.regex,i=c.succeed;return t("{").then(r(/^[a-z][a-z0-9]*/i)).skip(t("}")).then(function(e){return t("[").then(r(/^[-\w\s]*/)).skip(t("]")).or(i(void 0)).map(function(t){return n.setOptions(H[e](t))})})},zt=Vr,u.embed=zt,o["\\"]=(__extends(Kr,mn=n),Kr.prototype.replaces=function(t){this._replacedFragment=t.disown(),this.isEmpty=function(){return!1}},Kr.prototype.createBlocks=function(){var t,r;mn.prototype.createBlocks.call(this),(t=this.ends[b]).focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},t.blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this},t.write=function(t,e){var n;t.show().deleteSelection(),e.match(/[a-z]/i)?(new rt(e).createLeftOf(t),t.controller.aria.alert(e)):(n=this.parent.renderCommand(t),t.controller.aria.queue(n.mathspeak({createdLeftOf:t})),"\\"===e&&this.isEmpty()?t.controller.aria.alert():t.parent.write(t,e))},r=t.keystroke,t.keystroke=function(t,e,n){if("Tab"!==t&&"Enter"!==t&&"Spacebar"!==t)return r.call(this,t,e,n);t=this.parent.renderCommand(n.cursor),n.aria.alert(t.mathspeak({createdLeftOf:n.cursor})),e.preventDefault()}},Kr.prototype.createLeftOf=function(t){var e;mn.prototype.createLeftOf.call(this,t),this._replacedFragment&&(e=this.jQ[0],this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",function(t){return t.target=e,g(e).trigger(t),!1}).insertBefore(this.jQ).add(this.jQ))},Kr.prototype.latex=function(){return"\\"+this.ends[b].latex()+" "},Kr.prototype.renderCommand=function(t){var e,n,r;return this.jQ=this.jQ.last(),this.remove(),this[1]?t.insLeftOf(this[1]):t.insAtRightEnd(this.parent),e=this.ends[b].latex(),(n=u[e=e||" "])?(r=void 0,r=On(n)?new n(e):n(e),this._replacedFragment&&r.replaces(this._replacedFragment),r.createLeftOf(t)):((r=new ot).replaces(e),r.createLeftOf(t),t.insRightOf(r),this._replacedFragment&&this._replacedFragment.remove()),r},Kr),Nt=An(1))!function(t,e){"function"==typeof e?(Cn[t]=function(){return V(),e.apply(this,arguments)}).prototype=e.prototype:Cn[t]=e}(Ft,Nt[Ft])}();
